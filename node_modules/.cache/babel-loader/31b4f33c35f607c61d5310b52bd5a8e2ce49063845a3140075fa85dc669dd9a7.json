{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\aanime\\\\commeff3\\\\src\\\\pages\\\\PresentationEditorV3.jsx\",\n  _s2 = $RefreshSig$();\nimport React, { useState, useEffect, useCallback, useMemo, useRef } from 'react';\nimport { doc, getDoc, updateDoc, setDoc, collection, getDocs, query, orderBy, onSnapshot, addDoc, serverTimestamp } from 'firebase/firestore';\nimport { db } from '../firebase/config';\nimport { PresentationToolbar } from './PresentationToolbar';\nimport { SlidesSidebar } from './SlidesSidebar';\nimport { SlideCanvas } from './SlideCanvas';\nimport { ToastContainer } from '../components/Toast';\nimport { useAuth } from '../contexts/AuthContext';\nimport PresentationService from '../services/PresentationService';\nimport { ThumbsUp, MessageSquare } from 'lucide-react';\n\n// Types (replace with import from types/presentation if available)\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst initialPresentation = {\n  id: 'presentation-1',\n  title: 'Untitled Presentation',\n  slides: [{\n    id: 'slide-1',\n    title: 'Welcome Slide',\n    elements: []\n  }],\n  createdAt: new Date(),\n  updatedAt: new Date(),\n  currentSlideIndex: 0\n};\nexport default function PresentationEditorV3({\n  courseId,\n  presentationId = 'demo-presentation',\n  title\n}) {\n  _s2();\n  var _s = $RefreshSig$();\n  const {\n    currentUser\n  } = useAuth();\n  // All hooks must be at the top, before any return or conditional\n  const [presentation, setPresentation] = useState(initialPresentation);\n  const [editorState, setEditorState] = useState({\n    selectedElement: null,\n    tool: 'select',\n    isPresenting: false,\n    zoom: 100\n  });\n  const [isLoading, setIsLoading] = useState(true);\n  const [isSaving, setIsSaving] = useState(false);\n  const [toasts, setToasts] = useState([]);\n  const [audienceMode, setAudienceMode] = useState('enrolledUsers');\n  // --- Discussion state/hooks for instructor live mode ---\n  const [showDiscussion, setShowDiscussion] = useState(false);\n  const [commentInput, setCommentInput] = useState(\"\");\n  const [comments, setComments] = useState([]);\n  // Memoize props for PresentationFullScreen to prevent remounts\n  const slides = useMemo(() => Array.isArray(presentation.slides) ? presentation.slides : [], [presentation.slides]);\n  const memoizedComments = useMemo(() => comments, [comments]);\n  const memoizedHandleCommentSubmit = useCallback(handleCommentSubmit, [commentInput, currentUser, slides, presentation.currentSlideIndex, courseId, presentationId]);\n  const memoizedHandleLike = useCallback(handleLike, [currentUser, slides, presentation.currentSlideIndex, courseId, presentationId]);\n  // Real-time Firestore sync for comments (current slide)\n  useEffect(() => {\n    if (!editorState.isPresenting || !presentationId || !courseId || !Array.isArray(presentation.slides) || !presentation.slides.length) return;\n    const currentSlide = presentation.slides[presentation.currentSlideIndex];\n    if (!currentSlide) return;\n    const commentsCol = collection(db, 'courses', courseId, 'presentations', presentationId, 'slides', currentSlide.id, 'comments');\n    const q = query(commentsCol, orderBy('timePosted', 'asc'));\n    const unsub = onSnapshot(q, snap => {\n      const arr = [];\n      snap.forEach(doc => arr.push({\n        id: doc.id,\n        ...doc.data()\n      }));\n      setComments(arr);\n    });\n    return () => unsub();\n  }, [editorState.isPresenting, presentationId, courseId, presentation.slides, presentation.currentSlideIndex]);\n\n  // Toast management\n  const addToast = useCallback((message, type = 'info', duration = 3000) => {\n    const id = Date.now().toString();\n    setToasts(prev => [...prev, {\n      id,\n      message,\n      type,\n      duration\n    }]);\n  }, []);\n  const removeToast = useCallback(id => {\n    setToasts(prev => prev.filter(toast => toast.id !== id));\n  }, []);\n\n  // Load presentation from Firestore\n  useEffect(() => {\n    const loadPresentation = async () => {\n      try {\n        console.log('Loading presentation:', presentationId);\n        const docRef = doc(db, 'courses', courseId, 'presentations', presentationId);\n        const docSnap = await getDoc(docRef);\n        let slides = [];\n        // Fetch slides from subcollection\n        const slidesCol = collection(db, 'courses', courseId, 'presentations', presentationId, 'slides');\n        const slidesQuery = query(slidesCol, orderBy('order'));\n        const slidesSnap = await getDocs(slidesQuery);\n        slides = slidesSnap.docs.map(doc => {\n          const data = doc.data();\n          return {\n            id: doc.id,\n            ...data,\n            elements: Array.isArray(data.elements) ? data.elements : []\n          };\n        });\n        console.log('[PresentationEditorV3] Fetched slides from subcollection:', slides);\n        if (docSnap.exists()) {\n          var _data$createdAt, _data$updatedAt;\n          const data = docSnap.data();\n          setPresentation({\n            ...data,\n            slides,\n            createdAt: ((_data$createdAt = data.createdAt) === null || _data$createdAt === void 0 ? void 0 : _data$createdAt.toDate()) || new Date(),\n            updatedAt: ((_data$updatedAt = data.updatedAt) === null || _data$updatedAt === void 0 ? void 0 : _data$updatedAt.toDate()) || new Date()\n          });\n        } else {\n          if (!currentUser) throw new Error('Not authenticated');\n          console.log('No presentation found, creating new one');\n          await setDoc(docRef, {\n            ...initialPresentation,\n            slides: [],\n            id: presentationId,\n            createdAt: new Date(),\n            updatedAt: new Date(),\n            ownerId: currentUser.uid,\n            courseId: courseId || null\n          });\n          setPresentation({\n            ...initialPresentation,\n            slides: [],\n            id: presentationId,\n            ownerId: currentUser.uid,\n            courseId: courseId || null\n          });\n        }\n      } catch (error) {\n        console.error('Error loading presentation:', error);\n        if (error.code === 'permission-denied' || error.message.includes('permission')) {\n          addToast('You do not have permission to access this presentation.', 'error', 6000);\n        } else {\n          addToast('Failed to load presentation', 'error');\n        }\n      } finally {\n        setIsLoading(false);\n      }\n    };\n    if (currentUser) loadPresentation();\n  }, [presentationId, addToast, currentUser, courseId]);\n\n  // Add logging after fetching presentation and slides\n  useEffect(() => {\n    if (presentation) {\n      console.log('[PresentationEditorV3] Loaded presentation:', presentation);\n      if (presentation.slides) {\n        console.log('[PresentationEditorV3] Slides array:', presentation.slides);\n        presentation.slides.forEach((slide, idx) => {\n          console.log(`[PresentationEditorV3] Slide ${idx} imageUrl:`, slide.imageUrl);\n        });\n      } else {\n        console.log('[PresentationEditorV3] No slides found in presentation.');\n      }\n    }\n  }, [presentation]);\n\n  // Auto-save with debouncing\n  const saveTimeoutRef = React.useRef(null);\n  const savePresentation = useCallback(async presentationData => {\n    try {\n      if (!currentUser) throw new Error('Not authenticated');\n      console.log('Saving presentation:', presentationData);\n      setIsSaving(true);\n      const docRef = doc(db, 'courses', courseId, 'presentations', presentationId);\n      await updateDoc(docRef, {\n        ...presentationData,\n        updatedAt: new Date(),\n        ownerId: currentUser.uid,\n        courseId: courseId || null\n      });\n      console.log('Presentation saved successfully');\n      addToast('Presentation saved', 'success', 2000);\n    } catch (error) {\n      console.error('Error saving presentation:', error);\n      if (error.code === 'permission-denied' || error.message.includes('permission')) {\n        addToast('You do not have permission to save this presentation.', 'error', 6000);\n      } else {\n        addToast('Failed to save presentation', 'error');\n      }\n    } finally {\n      setIsSaving(false);\n    }\n  }, [presentationId, addToast, currentUser, courseId]);\n\n  // Debounced auto-save\n  useEffect(() => {\n    if (saveTimeoutRef.current) {\n      clearTimeout(saveTimeoutRef.current);\n    }\n    if (!isLoading) {\n      saveTimeoutRef.current = setTimeout(() => {\n        savePresentation(presentation);\n      }, 2000); // 2 second delay\n    }\n    return () => {\n      if (saveTimeoutRef.current) {\n        clearTimeout(saveTimeoutRef.current);\n      }\n    };\n  }, [presentation, savePresentation, isLoading]);\n\n  // Manual save handler\n  const handleSave = useCallback(async () => {\n    if (saveTimeoutRef.current) {\n      clearTimeout(saveTimeoutRef.current);\n    }\n    await savePresentation(presentation);\n  }, [presentation, savePresentation]);\n\n  // Slide management handlers\n  const handleAddSlide = useCallback(() => {\n    const newSlide = {\n      id: `slide-${Date.now()}`,\n      title: `Slide ${presentation.slides.length + 1}`,\n      elements: []\n    };\n    setPresentation(prev => ({\n      ...prev,\n      slides: [...prev.slides, newSlide],\n      currentSlideIndex: prev.slides.length\n    }));\n    addToast('New slide added', 'success', 2000);\n  }, [presentation.slides.length, addToast]);\n  const handleDuplicateSlide = useCallback(index => {\n    const slideToDuplicate = presentation.slides[index];\n    const newSlide = {\n      ...slideToDuplicate,\n      id: `slide-${Date.now()}`,\n      title: `${slideToDuplicate.title} (Copy)`\n    };\n    const newSlides = [...presentation.slides];\n    newSlides.splice(index + 1, 0, newSlide);\n    setPresentation(prev => ({\n      ...prev,\n      slides: newSlides,\n      currentSlideIndex: index + 1\n    }));\n    addToast('Slide duplicated', 'success', 2000);\n  }, [presentation.slides, addToast]);\n  const handleDeleteSlide = useCallback(index => {\n    if (presentation.slides.length <= 1) {\n      addToast('Cannot delete the last slide', 'warning');\n      return;\n    }\n    const newSlides = presentation.slides.filter((_, i) => i !== index);\n    const newCurrentIndex = Math.min(presentation.currentSlideIndex, newSlides.length - 1);\n    setPresentation(prev => ({\n      ...prev,\n      slides: newSlides,\n      currentSlideIndex: newCurrentIndex\n    }));\n    addToast('Slide deleted', 'success', 2000);\n  }, [presentation.slides, presentation.currentSlideIndex, addToast]);\n  const handleAddSlideAfter = useCallback(index => {\n    const newSlide = {\n      id: `slide-${Date.now()}`,\n      title: `Slide ${presentation.slides.length + 1}`,\n      elements: []\n    };\n    const newSlides = [...presentation.slides];\n    newSlides.splice(index + 1, 0, newSlide);\n    setPresentation(prev => ({\n      ...prev,\n      slides: newSlides,\n      currentSlideIndex: index + 1\n    }));\n    addToast('New slide added', 'success', 2000);\n  }, [presentation.slides.length, addToast]);\n\n  // Element management handlers\n  const handleElementSelect = useCallback(elementId => {\n    setEditorState(prev => ({\n      ...prev,\n      selectedElement: elementId\n    }));\n  }, []);\n  const handleElementUpdate = useCallback((elementId, updates) => {\n    setPresentation(prev => {\n      const newSlides = [...prev.slides];\n      const currentSlide = newSlides[prev.currentSlideIndex];\n      const elementIndex = currentSlide.elements.findIndex(el => el.id === elementId);\n      if (elementIndex !== -1) {\n        newSlides[prev.currentSlideIndex] = {\n          ...currentSlide,\n          elements: currentSlide.elements.map((el, index) => index === elementIndex ? {\n            ...el,\n            ...updates\n          } : el)\n        };\n      }\n      return {\n        ...prev,\n        slides: newSlides\n      };\n    });\n  }, []);\n  const handleElementAdd = useCallback(elementData => {\n    const newElement = {\n      id: `element-${Date.now()}`,\n      ...elementData\n    };\n    setPresentation(prev => {\n      const newSlides = [...prev.slides];\n      const currentSlide = newSlides[prev.currentSlideIndex];\n      newSlides[prev.currentSlideIndex] = {\n        ...currentSlide,\n        elements: [...currentSlide.elements, newElement]\n      };\n      return {\n        ...prev,\n        slides: newSlides\n      };\n    });\n\n    // Auto-select the new element\n    setEditorState(prev => ({\n      ...prev,\n      selectedElement: newElement.id\n    }));\n    addToast('Element added', 'success', 1500);\n  }, [addToast]);\n  const handleElementDelete = useCallback(elementId => {\n    setPresentation(prev => {\n      const newSlides = [...prev.slides];\n      const currentSlide = newSlides[prev.currentSlideIndex];\n      newSlides[prev.currentSlideIndex] = {\n        ...currentSlide,\n        elements: currentSlide.elements.filter(el => el.id !== elementId)\n      };\n      return {\n        ...prev,\n        slides: newSlides\n      };\n    });\n    setEditorState(prev => ({\n      ...prev,\n      selectedElement: null\n    }));\n    addToast('Element deleted', 'success', 1500);\n  }, [addToast]);\n\n  // Other handlers\n  const handleToolChange = useCallback(tool => {\n    setEditorState(prev => ({\n      ...prev,\n      tool\n    }));\n  }, []);\n  const handleTitleChange = useCallback(title => {\n    setPresentation(prev => ({\n      ...prev,\n      title\n    }));\n  }, []);\n  const handleSlideSelect = useCallback(index => {\n    setPresentation(prev => ({\n      ...prev,\n      currentSlideIndex: index\n    }));\n    setEditorState(prev => ({\n      ...prev,\n      selectedElement: null\n    }));\n  }, []);\n  const handlePresent = useCallback(() => {\n    setEditorState(prev => ({\n      ...prev,\n      isPresenting: true\n    }));\n    addToast('Starting presentation...', 'info');\n  }, [addToast]);\n\n  // Remove auto-save useEffect\n  // Add slide change handler\n  const handleSlideChange = useCallback((field, value) => {\n    setPresentation(prev => {\n      const newSlides = [...prev.slides];\n      const idx = prev.currentSlideIndex;\n      if (!newSlides[idx]) return prev;\n      newSlides[idx] = {\n        ...newSlides[idx],\n        [field]: value\n      };\n      return {\n        ...prev,\n        slides: newSlides\n      };\n    });\n  }, []);\n\n  // Update currentSlideIndex in Firestore when it changes\n  useEffect(() => {\n    if (!presentationId || !courseId || !currentUser) return;\n    const updateCurrentSlideIndex = async () => {\n      try {\n        const docRef = doc(db, 'courses', courseId, 'presentations', presentationId);\n        await updateDoc(docRef, {\n          currentSlideIndex: presentation.currentSlideIndex\n        });\n        // Optionally log\n        // console.log('[PresentationEditorV3] Updated currentSlideIndex in Firestore:', presentation.currentSlideIndex);\n      } catch (err) {\n        console.error('[PresentationEditorV3] Error updating currentSlideIndex:', err);\n      }\n    };\n    updateCurrentSlideIndex();\n  }, [presentation.currentSlideIndex, presentationId, courseId, currentUser]);\n\n  // Find selected element from current slide\n  const selectedElement = React.useMemo(() => {\n    const slide = presentation.slides[presentation.currentSlideIndex];\n    if (!slide) return null;\n    return slide.elements.find(el => el.id === editorState.selectedElement) || null;\n  }, [presentation, editorState.selectedElement]);\n\n  // Compute formatting state for toolbar\n  const formattingState = React.useMemo(() => {\n    if (!selectedElement || selectedElement.type !== 'text') return {};\n    const style = selectedElement.style || {};\n    return {\n      bold: style.fontWeight === 'bold',\n      italic: style.fontStyle === 'italic',\n      underline: style.textDecoration === 'underline',\n      fontSize: style.fontSize || 16,\n      color: style.color || '#000000',\n      align: style.textAlign || 'left'\n    };\n  }, [selectedElement]);\n\n  // Handler for formatting actions\n  const handleFormat = useCallback((action, value) => {\n    if (!selectedElement || selectedElement.type !== 'text') return;\n    setPresentation(prev => {\n      const newSlides = [...prev.slides];\n      const slide = newSlides[prev.currentSlideIndex];\n      const idx = slide.elements.findIndex(el => el.id === selectedElement.id);\n      if (idx === -1) return prev;\n      const el = slide.elements[idx];\n      const style = {\n        ...el.style\n      };\n      switch (action) {\n        case 'bold':\n          style.fontWeight = style.fontWeight === 'bold' ? 'normal' : 'bold';\n          break;\n        case 'italic':\n          style.fontStyle = style.fontStyle === 'italic' ? 'normal' : 'italic';\n          break;\n        case 'underline':\n          style.textDecoration = style.textDecoration === 'underline' ? 'none' : 'underline';\n          break;\n        case 'fontSize':\n          style.fontSize = value || 20; // Default to 20 if not provided\n          break;\n        case 'color':\n          style.color = value || '#000000';\n          break;\n        case 'align':\n          style.textAlign = value;\n          break;\n        default:\n          break;\n      }\n      slide.elements[idx] = {\n        ...el,\n        style\n      };\n      return {\n        ...prev,\n        slides: newSlides\n      };\n    });\n  }, [selectedElement]);\n\n  // Loading state\n  if (isLoading) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"h-screen flex items-center justify-center bg-gray-100\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-center\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 456,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-gray-600\",\n          children: \"Loading presentation...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 457,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 455,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 454,\n      columnNumber: 7\n    }, this);\n  }\n\n  // Comment submit\n  const handleCommentSubmit = async e => {\n    e.preventDefault();\n    if (!commentInput.trim() || !currentUser) return;\n    const currentSlide = slides[presentation.currentSlideIndex];\n    if (!currentSlide) return;\n    const commentsCol = collection(db, 'courses', courseId, 'presentations', presentationId, 'slides', currentSlide.id, 'comments');\n    await addDoc(commentsCol, {\n      text: commentInput,\n      username: currentUser.displayName || currentUser.email || currentUser.uid,\n      likedBy: {},\n      timePosted: serverTimestamp(),\n      groupId: null\n    });\n    setCommentInput(\"\");\n  };\n  // Like handler (likedBy map logic)\n  const handleLike = async comment => {\n    if (!currentUser) return;\n    const currentSlide = slides[presentation.currentSlideIndex];\n    if (!currentSlide) return;\n    const likeUserId = currentUser.uid;\n    if (comment.likedBy && comment.likedBy[likeUserId]) return;\n    const newLikedBy = {\n      ...(comment.likedBy || {})\n    };\n    newLikedBy[likeUserId] = true;\n    const commentRef = doc(db, 'courses', courseId, 'presentations', presentationId, 'slides', currentSlide.id, 'comments', comment.id);\n    // Fetch the current Firestore document to get the exact fields\n    const snap = await getDoc(commentRef);\n    const firestoreData = snap.data();\n    // Build update payload: copy all fields from Firestore, update likedBy\n    const updatePayload = {\n      ...firestoreData,\n      likedBy: newLikedBy\n    };\n    // Remove id field if present\n    delete updatePayload.id;\n    console.log('Firestore comment doc:', firestoreData);\n    console.log('Update payload:', updatePayload);\n    await updateDoc(commentRef, updatePayload);\n  };\n  const PresentationFullScreen = /*#__PURE__*/_s(/*#__PURE__*/React.memo(_s(function PresentationFullScreen({\n    slides,\n    currentIndex,\n    onClose,\n    onPrev,\n    onNext,\n    showDiscussion,\n    setShowDiscussion,\n    comments,\n    commentInput,\n    setCommentInput,\n    handleCommentSubmit,\n    handleLike,\n    currentUser\n  }) {\n    _s();\n    const total = slides.length;\n    const slide = slides[currentIndex] || {};\n    const containerRef = useRef();\n    // Only use useRef and useEffect for keydown events here. No useState/useEffect for discussion logic.\n    useEffect(() => {\n      const handleKeyDown = e => {\n        if (e.key === 'ArrowLeft') onPrev();\n        if (e.key === 'ArrowRight') onNext();\n        if (e.key === 'Escape') onClose();\n      };\n      window.addEventListener('keydown', handleKeyDown);\n      return () => window.removeEventListener('keydown', handleKeyDown);\n    }, [onPrev, onNext, onClose]);\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      ref: containerRef,\n      className: \"fixed inset-0 z-50 bg-black flex flex-col items-center justify-center\",\n      style: {\n        minHeight: '100vh',\n        minWidth: '100vw'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"absolute top-4 right-8 z-20 text-white text-sm bg-black/60 px-3 py-1 rounded-full shadow\",\n        children: currentUser && (currentUser.displayName || currentUser.email || currentUser.uid)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 519,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"absolute top-4 right-24 z-30 bg-white bg-opacity-80 rounded-full p-2 shadow hover:bg-primary-100\",\n        title: \"Open discussion\",\n        onClick: () => setShowDiscussion(true),\n        children: /*#__PURE__*/_jsxDEV(MessageSquare, {\n          className: \"w-6 h-6 text-primary-600\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 528,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 523,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: onClose,\n        className: \"absolute top-4 right-40 text-white text-3xl font-bold bg-black bg-opacity-40 rounded px-3 py-1 hover:bg-opacity-70\",\n        children: \"\\xD7\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 531,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: onPrev,\n        className: \"absolute left-4 top-1/2 -translate-y-1/2 text-white text-5xl font-bold bg-black bg-opacity-40 rounded-full px-3 py-1 hover:bg-opacity-70\",\n        style: {\n          zIndex: 10\n        },\n        \"aria-label\": \"Previous slide\",\n        children: \"\\u2190\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 533,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: onNext,\n        className: \"absolute right-4 top-1/2 -translate-y-1/2 text-white text-5xl font-bold bg-black bg-opacity-40 rounded-full px-3 py-1 hover:bg-opacity-70\",\n        style: {\n          zIndex: 10\n        },\n        \"aria-label\": \"Next slide\",\n        children: \"\\u2192\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 535,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex flex-col items-center justify-center w-full h-full\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center justify-center\",\n          style: {\n            width: '96vw',\n            height: '96vh',\n            maxWidth: '100vw',\n            maxHeight: '100vh',\n            padding: 0,\n            margin: 0\n          },\n          children: slide.imageUrl ? /*#__PURE__*/_jsxDEV(\"img\", {\n            src: slide.imageUrl,\n            alt: slide.title || 'Slide',\n            style: {\n              width: '100%',\n              height: '100%',\n              objectFit: 'contain',\n              background: '#222'\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 540,\n            columnNumber: 15\n          }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"bg-white w-full h-full flex flex-col items-center justify-center\",\n            children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n              className: \"text-4xl font-bold mb-4\",\n              children: slide.title || 'Untitled Slide'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 543,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"text-lg text-gray-700\",\n              children: slide.content || ''\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 544,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 542,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 538,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"absolute bottom-8 left-1/2 -translate-x-1/2 bg-black bg-opacity-60 text-white px-4 py-2 rounded text-lg font-semibold\",\n          children: [\"Slide \", currentIndex + 1, \" / \", total]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 549,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 537,\n        columnNumber: 9\n      }, this), showDiscussion && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"fixed inset-0 z-60 flex items-center justify-center bg-black bg-opacity-60\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"absolute inset-0\",\n          onClick: () => setShowDiscussion(false)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 556,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"relative flex w-full h-full z-70\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex-1 bg-gray-100 flex flex-col items-center justify-center border-r border-gray-300\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"text-gray-400 text-lg\",\n              children: \"(Grouping area placeholder)\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 560,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 559,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"w-[400px] max-w-full bg-white flex flex-col h-full shadow-xl\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex items-center justify-between px-4 py-3 border-b\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"font-semibold text-lg\",\n                children: \"Slide Discussion\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 566,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: () => setShowDiscussion(false),\n                className: \"text-gray-500 hover:text-primary-600 text-xl\",\n                children: \"\\xD7\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 567,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 565,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex-1 overflow-y-auto p-4 space-y-3\",\n              children: comments.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"text-gray-400 text-center\",\n                children: \"No messages yet.\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 572,\n                columnNumber: 21\n              }, this) : comments.map(c => {\n                const likeUserId = currentUser ? currentUser.uid : '';\n                const alreadyLiked = c.likedBy && likeUserId && c.likedBy[likeUserId];\n                const likeCount = c.likedBy ? Object.keys(c.likedBy).length : 0;\n                return /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"bg-gray-100 rounded px-3 py-2 flex items-center group\",\n                  title: c.username,\n                  children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                    className: `flex items-center mr-3 text-gray-500 hover:text-primary-600 focus:outline-none ${alreadyLiked ? 'opacity-50 cursor-not-allowed' : ''}`,\n                    onClick: () => handleLike(c),\n                    tabIndex: 0,\n                    \"aria-label\": \"Like comment\",\n                    disabled: alreadyLiked,\n                    children: [/*#__PURE__*/_jsxDEV(ThumbsUp, {\n                      className: \"w-5 h-5 mr-1\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 592,\n                      columnNumber: 29\n                    }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                      className: \"text-sm font-semibold\",\n                      children: likeCount\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 593,\n                      columnNumber: 29\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 585,\n                    columnNumber: 27\n                  }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                    className: \"text-gray-800 text-sm\",\n                    style: {\n                      cursor: 'pointer'\n                    },\n                    children: c.text\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 596,\n                    columnNumber: 27\n                  }, this)]\n                }, c.id, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 579,\n                  columnNumber: 25\n                }, this);\n              })\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 570,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n              className: \"flex items-center border-t px-4 py-3\",\n              onSubmit: handleCommentSubmit,\n              children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"text\",\n                className: \"flex-1 border rounded px-3 py-2 mr-2 focus:outline-none focus:border-primary-500\",\n                placeholder: \"Type a comment...\",\n                value: commentInput,\n                onChange: e => setCommentInput(e.target.value)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 606,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                type: \"submit\",\n                className: \"bg-primary-600 text-white px-4 py-2 rounded font-semibold disabled:opacity-50\",\n                disabled: !commentInput.trim(),\n                children: \"Send\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 613,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 605,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 563,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 557,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 555,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 517,\n      columnNumber: 7\n    }, this);\n  }, \"8puyVO4ts1RhCfXUmci3vLI3Njw=\")), \"8puyVO4ts1RhCfXUmci3vLI3Njw=\");\n\n  // Audience mode change handler\n  const handleAudienceModeChange = async newMode => {\n    try {\n      await PresentationService.setAudienceMode(courseId, presentationId, newMode);\n      setAudienceMode(newMode);\n      addToast(`Audience mode set to ${newMode === 'anonymous' ? 'Anonymous' : 'Enrolled Users'}`, 'success');\n    } catch (err) {\n      addToast('Failed to update audience mode', 'error');\n      console.error('[PresentationEditorV3] Error updating audience mode:', err);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"h-screen flex flex-col\",\n    children: [/*#__PURE__*/_jsxDEV(PresentationToolbar, {\n      editorState: editorState,\n      onToolChange: handleToolChange,\n      onSave: handleSave,\n      onPresent: handlePresent,\n      onUndo: () => {} // TODO: Implement undo/redo\n      ,\n      onRedo: () => {},\n      presentationTitle: presentation.title,\n      onTitleChange: handleTitleChange,\n      isSaving: isSaving,\n      selectedElement: selectedElement,\n      formattingState: formattingState,\n      onFormat: handleFormat,\n      audienceMode: audienceMode,\n      onAudienceModeChange: handleAudienceModeChange\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 640,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex-1 flex\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"h-full overflow-y-auto\",\n        style: {\n          maxHeight: 'calc(100vh - 64px)',\n          minWidth: 120\n        },\n        children: /*#__PURE__*/_jsxDEV(SlidesSidebar, {\n          slides: presentation.slides,\n          currentSlideIndex: presentation.currentSlideIndex,\n          onSlideSelect: handleSlideSelect,\n          onAddSlide: handleAddSlide,\n          onDuplicateSlide: handleDuplicateSlide,\n          onDeleteSlide: handleDeleteSlide,\n          onAddSlideAfter: handleAddSlideAfter\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 659,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 658,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(SlideCanvas, {\n        slide: presentation.slides[presentation.currentSlideIndex],\n        editorState: editorState,\n        onElementSelect: handleElementSelect,\n        onElementUpdate: handleElementUpdate,\n        onElementAdd: handleElementAdd,\n        onElementDelete: handleElementDelete,\n        onSlideChange: handleSlideChange,\n        isLive: editorState.isPresenting\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 670,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 656,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ToastContainer, {\n      toasts: toasts,\n      removeToast: removeToast\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 682,\n      columnNumber: 7\n    }, this), editorState.isPresenting && /*#__PURE__*/_jsxDEV(PresentationFullScreen, {\n      slides: slides,\n      currentIndex: presentation.currentSlideIndex,\n      onClose: () => setEditorState(prev => ({\n        ...prev,\n        isPresenting: false\n      })),\n      onPrev: () => setPresentation(prev => ({\n        ...prev,\n        currentSlideIndex: Math.max(0, prev.currentSlideIndex - 1)\n      })),\n      onNext: () => setPresentation(prev => ({\n        ...prev,\n        currentSlideIndex: Math.min(slides.length - 1, prev.currentSlideIndex + 1)\n      })),\n      showDiscussion: showDiscussion,\n      setShowDiscussion: setShowDiscussion,\n      comments: memoizedComments,\n      commentInput: commentInput,\n      setCommentInput: setCommentInput,\n      handleCommentSubmit: memoizedHandleCommentSubmit,\n      handleLike: memoizedHandleLike,\n      currentUser: currentUser\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 684,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 638,\n    columnNumber: 5\n  }, this);\n}\n_s2(PresentationEditorV3, \"m80Fl51dOkXu2H6vuztLaL/JEVs=\", false, function () {\n  return [useAuth];\n});\n_c = PresentationEditorV3;\nvar _c;\n$RefreshReg$(_c, \"PresentationEditorV3\");","map":{"version":3,"names":["React","useState","useEffect","useCallback","useMemo","useRef","doc","getDoc","updateDoc","setDoc","collection","getDocs","query","orderBy","onSnapshot","addDoc","serverTimestamp","db","PresentationToolbar","SlidesSidebar","SlideCanvas","ToastContainer","useAuth","PresentationService","ThumbsUp","MessageSquare","jsxDEV","_jsxDEV","initialPresentation","id","title","slides","elements","createdAt","Date","updatedAt","currentSlideIndex","PresentationEditorV3","courseId","presentationId","_s2","_s","$RefreshSig$","currentUser","presentation","setPresentation","editorState","setEditorState","selectedElement","tool","isPresenting","zoom","isLoading","setIsLoading","isSaving","setIsSaving","toasts","setToasts","audienceMode","setAudienceMode","showDiscussion","setShowDiscussion","commentInput","setCommentInput","comments","setComments","Array","isArray","memoizedComments","memoizedHandleCommentSubmit","handleCommentSubmit","memoizedHandleLike","handleLike","length","currentSlide","commentsCol","q","unsub","snap","arr","forEach","push","data","addToast","message","type","duration","now","toString","prev","removeToast","filter","toast","loadPresentation","console","log","docRef","docSnap","slidesCol","slidesQuery","slidesSnap","docs","map","exists","_data$createdAt","_data$updatedAt","toDate","Error","ownerId","uid","error","code","includes","slide","idx","imageUrl","saveTimeoutRef","savePresentation","presentationData","current","clearTimeout","setTimeout","handleSave","handleAddSlide","newSlide","handleDuplicateSlide","index","slideToDuplicate","newSlides","splice","handleDeleteSlide","_","i","newCurrentIndex","Math","min","handleAddSlideAfter","handleElementSelect","elementId","handleElementUpdate","updates","elementIndex","findIndex","el","handleElementAdd","elementData","newElement","handleElementDelete","handleToolChange","handleTitleChange","handleSlideSelect","handlePresent","handleSlideChange","field","value","updateCurrentSlideIndex","err","find","formattingState","style","bold","fontWeight","italic","fontStyle","underline","textDecoration","fontSize","color","align","textAlign","handleFormat","action","className","children","fileName","_jsxFileName","lineNumber","columnNumber","e","preventDefault","trim","text","username","displayName","email","likedBy","timePosted","groupId","comment","likeUserId","newLikedBy","commentRef","firestoreData","updatePayload","PresentationFullScreen","memo","currentIndex","onClose","onPrev","onNext","total","containerRef","handleKeyDown","key","window","addEventListener","removeEventListener","ref","minHeight","minWidth","onClick","zIndex","width","height","maxWidth","maxHeight","padding","margin","src","alt","objectFit","background","content","c","alreadyLiked","likeCount","Object","keys","tabIndex","disabled","cursor","onSubmit","placeholder","onChange","target","handleAudienceModeChange","newMode","onToolChange","onSave","onPresent","onUndo","onRedo","presentationTitle","onTitleChange","onFormat","onAudienceModeChange","onSlideSelect","onAddSlide","onDuplicateSlide","onDeleteSlide","onAddSlideAfter","onElementSelect","onElementUpdate","onElementAdd","onElementDelete","onSlideChange","isLive","max","_c","$RefreshReg$"],"sources":["C:/Users/aanime/commeff3/src/pages/PresentationEditorV3.jsx"],"sourcesContent":["import React, { useState, useEffect, useCallback, useMemo, useRef } from 'react';\nimport { doc, getDoc, updateDoc, setDoc, collection, getDocs, query, orderBy, onSnapshot, addDoc, serverTimestamp } from 'firebase/firestore';\nimport { db } from '../firebase/config';\nimport { PresentationToolbar } from './PresentationToolbar';\nimport { SlidesSidebar } from './SlidesSidebar';\nimport { SlideCanvas } from './SlideCanvas';\nimport { ToastContainer } from '../components/Toast';\nimport { useAuth } from '../contexts/AuthContext';\nimport PresentationService from '../services/PresentationService';\nimport { ThumbsUp, MessageSquare } from 'lucide-react';\n\n// Types (replace with import from types/presentation if available)\nconst initialPresentation = {\n  id: 'presentation-1',\n  title: 'Untitled Presentation',\n  slides: [\n    {\n      id: 'slide-1',\n      title: 'Welcome Slide',\n      elements: [],\n    },\n  ],\n  createdAt: new Date(),\n  updatedAt: new Date(),\n  currentSlideIndex: 0,\n};\n\nexport default function PresentationEditorV3({ courseId, presentationId = 'demo-presentation', title }) {\n  const { currentUser } = useAuth();\n  // All hooks must be at the top, before any return or conditional\n  const [presentation, setPresentation] = useState(initialPresentation);\n  const [editorState, setEditorState] = useState({\n    selectedElement: null,\n    tool: 'select',\n    isPresenting: false,\n    zoom: 100,\n  });\n  const [isLoading, setIsLoading] = useState(true);\n  const [isSaving, setIsSaving] = useState(false);\n  const [toasts, setToasts] = useState([]);\n  const [audienceMode, setAudienceMode] = useState('enrolledUsers');\n  // --- Discussion state/hooks for instructor live mode ---\n  const [showDiscussion, setShowDiscussion] = useState(false);\n  const [commentInput, setCommentInput] = useState(\"\");\n  const [comments, setComments] = useState([]);\n  // Memoize props for PresentationFullScreen to prevent remounts\n  const slides = useMemo(() => Array.isArray(presentation.slides) ? presentation.slides : [], [presentation.slides]);\n  const memoizedComments = useMemo(() => comments, [comments]);\n  const memoizedHandleCommentSubmit = useCallback(handleCommentSubmit, [commentInput, currentUser, slides, presentation.currentSlideIndex, courseId, presentationId]);\n  const memoizedHandleLike = useCallback(handleLike, [currentUser, slides, presentation.currentSlideIndex, courseId, presentationId]);\n  // Real-time Firestore sync for comments (current slide)\n  useEffect(() => {\n    if (!editorState.isPresenting || !presentationId || !courseId || !Array.isArray(presentation.slides) || !presentation.slides.length) return;\n    const currentSlide = presentation.slides[presentation.currentSlideIndex];\n    if (!currentSlide) return;\n    const commentsCol = collection(db, 'courses', courseId, 'presentations', presentationId, 'slides', currentSlide.id, 'comments');\n    const q = query(commentsCol, orderBy('timePosted', 'asc'));\n    const unsub = onSnapshot(q, (snap) => {\n      const arr = [];\n      snap.forEach(doc => arr.push({ id: doc.id, ...doc.data() }));\n      setComments(arr);\n    });\n    return () => unsub();\n  }, [editorState.isPresenting, presentationId, courseId, presentation.slides, presentation.currentSlideIndex]);\n\n  // Toast management\n  const addToast = useCallback((message, type = 'info', duration = 3000) => {\n    const id = Date.now().toString();\n    setToasts(prev => [...prev, { id, message, type, duration }]);\n  }, []);\n\n  const removeToast = useCallback((id) => {\n    setToasts(prev => prev.filter(toast => toast.id !== id));\n  }, []);\n\n  // Load presentation from Firestore\n  useEffect(() => {\n    const loadPresentation = async () => {\n      try {\n        console.log('Loading presentation:', presentationId);\n        const docRef = doc(db, 'courses', courseId, 'presentations', presentationId);\n        const docSnap = await getDoc(docRef);\n        let slides = [];\n        // Fetch slides from subcollection\n        const slidesCol = collection(db, 'courses', courseId, 'presentations', presentationId, 'slides');\n        const slidesQuery = query(slidesCol, orderBy('order'));\n        const slidesSnap = await getDocs(slidesQuery);\n        slides = slidesSnap.docs.map(doc => {\n          const data = doc.data();\n          return {\n            id: doc.id,\n            ...data,\n            elements: Array.isArray(data.elements) ? data.elements : [],\n          };\n        });\n        console.log('[PresentationEditorV3] Fetched slides from subcollection:', slides);\n        if (docSnap.exists()) {\n          const data = docSnap.data();\n          setPresentation({\n            ...data,\n            slides,\n            createdAt: data.createdAt?.toDate() || new Date(),\n            updatedAt: data.updatedAt?.toDate() || new Date(),\n          });\n        } else {\n          if (!currentUser) throw new Error('Not authenticated');\n          console.log('No presentation found, creating new one');\n          await setDoc(docRef, {\n            ...initialPresentation,\n            slides: [],\n            id: presentationId,\n            createdAt: new Date(),\n            updatedAt: new Date(),\n            ownerId: currentUser.uid,\n            courseId: courseId || null,\n          });\n          setPresentation({ ...initialPresentation, slides: [], id: presentationId, ownerId: currentUser.uid, courseId: courseId || null });\n        }\n      } catch (error) {\n        console.error('Error loading presentation:', error);\n        if (error.code === 'permission-denied' || error.message.includes('permission')) {\n          addToast('You do not have permission to access this presentation.', 'error', 6000);\n        } else {\n          addToast('Failed to load presentation', 'error');\n        }\n      } finally {\n        setIsLoading(false);\n      }\n    };\n    if (currentUser) loadPresentation();\n  }, [presentationId, addToast, currentUser, courseId]);\n\n  // Add logging after fetching presentation and slides\n  useEffect(() => {\n    if (presentation) {\n      console.log('[PresentationEditorV3] Loaded presentation:', presentation);\n      if (presentation.slides) {\n        console.log('[PresentationEditorV3] Slides array:', presentation.slides);\n        presentation.slides.forEach((slide, idx) => {\n          console.log(`[PresentationEditorV3] Slide ${idx} imageUrl:`, slide.imageUrl);\n        });\n      } else {\n        console.log('[PresentationEditorV3] No slides found in presentation.');\n      }\n    }\n  }, [presentation]);\n\n  // Auto-save with debouncing\n  const saveTimeoutRef = React.useRef(null);\n  const savePresentation = useCallback(async (presentationData) => {\n    try {\n      if (!currentUser) throw new Error('Not authenticated');\n      console.log('Saving presentation:', presentationData);\n      setIsSaving(true);\n      \n      const docRef = doc(db, 'courses', courseId, 'presentations', presentationId);\n      await updateDoc(docRef, {\n        ...presentationData,\n        updatedAt: new Date(),\n        ownerId: currentUser.uid,\n        courseId: courseId || null,\n      });\n      \n      console.log('Presentation saved successfully');\n      addToast('Presentation saved', 'success', 2000);\n    } catch (error) {\n      console.error('Error saving presentation:', error);\n      if (error.code === 'permission-denied' || error.message.includes('permission')) {\n        addToast('You do not have permission to save this presentation.', 'error', 6000);\n      } else {\n        addToast('Failed to save presentation', 'error');\n      }\n    } finally {\n      setIsSaving(false);\n    }\n  }, [presentationId, addToast, currentUser, courseId]);\n\n  // Debounced auto-save\n  useEffect(() => {\n    if (saveTimeoutRef.current) {\n      clearTimeout(saveTimeoutRef.current);\n    }\n    \n    if (!isLoading) {\n      saveTimeoutRef.current = setTimeout(() => {\n        savePresentation(presentation);\n      }, 2000); // 2 second delay\n    }\n\n    return () => {\n      if (saveTimeoutRef.current) {\n        clearTimeout(saveTimeoutRef.current);\n      }\n    };\n  }, [presentation, savePresentation, isLoading]);\n\n  // Manual save handler\n  const handleSave = useCallback(async () => {\n    if (saveTimeoutRef.current) {\n      clearTimeout(saveTimeoutRef.current);\n    }\n    await savePresentation(presentation);\n  }, [presentation, savePresentation]);\n\n  // Slide management handlers\n  const handleAddSlide = useCallback(() => {\n    const newSlide = {\n      id: `slide-${Date.now()}`,\n      title: `Slide ${presentation.slides.length + 1}`,\n      elements: [],\n    };\n    \n    setPresentation(prev => ({\n      ...prev,\n      slides: [...prev.slides, newSlide],\n      currentSlideIndex: prev.slides.length,\n    }));\n    \n    addToast('New slide added', 'success', 2000);\n  }, [presentation.slides.length, addToast]);\n\n  const handleDuplicateSlide = useCallback((index) => {\n    const slideToDuplicate = presentation.slides[index];\n    const newSlide = {\n      ...slideToDuplicate,\n      id: `slide-${Date.now()}`,\n      title: `${slideToDuplicate.title} (Copy)`,\n    };\n    \n    const newSlides = [...presentation.slides];\n    newSlides.splice(index + 1, 0, newSlide);\n    \n    setPresentation(prev => ({\n      ...prev,\n      slides: newSlides,\n      currentSlideIndex: index + 1,\n    }));\n    \n    addToast('Slide duplicated', 'success', 2000);\n  }, [presentation.slides, addToast]);\n\n  const handleDeleteSlide = useCallback((index) => {\n    if (presentation.slides.length <= 1) {\n      addToast('Cannot delete the last slide', 'warning');\n      return;\n    }\n    \n    const newSlides = presentation.slides.filter((_, i) => i !== index);\n    const newCurrentIndex = Math.min(\n      presentation.currentSlideIndex,\n      newSlides.length - 1\n    );\n    \n    setPresentation(prev => ({\n      ...prev,\n      slides: newSlides,\n      currentSlideIndex: newCurrentIndex,\n    }));\n    \n    addToast('Slide deleted', 'success', 2000);\n  }, [presentation.slides, presentation.currentSlideIndex, addToast]);\n\n  const handleAddSlideAfter = useCallback((index) => {\n    const newSlide = {\n      id: `slide-${Date.now()}`,\n      title: `Slide ${presentation.slides.length + 1}`,\n      elements: [],\n    };\n    \n    const newSlides = [...presentation.slides];\n    newSlides.splice(index + 1, 0, newSlide);\n    \n    setPresentation(prev => ({\n      ...prev,\n      slides: newSlides,\n      currentSlideIndex: index + 1,\n    }));\n    \n    addToast('New slide added', 'success', 2000);\n  }, [presentation.slides.length, addToast]);\n\n  // Element management handlers\n  const handleElementSelect = useCallback((elementId) => {\n    setEditorState(prev => ({ ...prev, selectedElement: elementId }));\n  }, []);\n\n  const handleElementUpdate = useCallback((elementId, updates) => {\n    setPresentation(prev => {\n      const newSlides = [...prev.slides];\n      const currentSlide = newSlides[prev.currentSlideIndex];\n      const elementIndex = currentSlide.elements.findIndex(el => el.id === elementId);\n      \n      if (elementIndex !== -1) {\n        newSlides[prev.currentSlideIndex] = {\n          ...currentSlide,\n          elements: currentSlide.elements.map((el, index) =>\n            index === elementIndex ? { ...el, ...updates } : el\n          ),\n        };\n      }\n      \n      return { ...prev, slides: newSlides };\n    });\n  }, []);\n\n  const handleElementAdd = useCallback((elementData) => {\n    const newElement = {\n      id: `element-${Date.now()}`,\n      ...elementData,\n    };\n    \n    setPresentation(prev => {\n      const newSlides = [...prev.slides];\n      const currentSlide = newSlides[prev.currentSlideIndex];\n      \n      newSlides[prev.currentSlideIndex] = {\n        ...currentSlide,\n        elements: [...currentSlide.elements, newElement],\n      };\n      \n      return { ...prev, slides: newSlides };\n    });\n    \n    // Auto-select the new element\n    setEditorState(prev => ({ ...prev, selectedElement: newElement.id }));\n    addToast('Element added', 'success', 1500);\n  }, [addToast]);\n\n  const handleElementDelete = useCallback((elementId) => {\n    setPresentation(prev => {\n      const newSlides = [...prev.slides];\n      const currentSlide = newSlides[prev.currentSlideIndex];\n      \n      newSlides[prev.currentSlideIndex] = {\n        ...currentSlide,\n        elements: currentSlide.elements.filter(el => el.id !== elementId),\n      };\n      \n      return { ...prev, slides: newSlides };\n    });\n    \n    setEditorState(prev => ({ ...prev, selectedElement: null }));\n    addToast('Element deleted', 'success', 1500);\n  }, [addToast]);\n\n  // Other handlers\n  const handleToolChange = useCallback((tool) => {\n    setEditorState(prev => ({ ...prev, tool }));\n  }, []);\n\n  const handleTitleChange = useCallback((title) => {\n    setPresentation(prev => ({ ...prev, title }));\n  }, []);\n\n  const handleSlideSelect = useCallback((index) => {\n    setPresentation(prev => ({ ...prev, currentSlideIndex: index }));\n    setEditorState(prev => ({ ...prev, selectedElement: null }));\n  }, []);\n\n  const handlePresent = useCallback(() => {\n    setEditorState(prev => ({ ...prev, isPresenting: true }));\n    addToast('Starting presentation...', 'info');\n  }, [addToast]);\n\n  // Remove auto-save useEffect\n  // Add slide change handler\n  const handleSlideChange = useCallback((field, value) => {\n    setPresentation(prev => {\n      const newSlides = [...prev.slides];\n      const idx = prev.currentSlideIndex;\n      if (!newSlides[idx]) return prev;\n      newSlides[idx] = { ...newSlides[idx], [field]: value };\n      return { ...prev, slides: newSlides };\n    });\n  }, []);\n\n  // Update currentSlideIndex in Firestore when it changes\n  useEffect(() => {\n    if (!presentationId || !courseId || !currentUser) return;\n    const updateCurrentSlideIndex = async () => {\n      try {\n        const docRef = doc(db, 'courses', courseId, 'presentations', presentationId);\n        await updateDoc(docRef, { currentSlideIndex: presentation.currentSlideIndex });\n        // Optionally log\n        // console.log('[PresentationEditorV3] Updated currentSlideIndex in Firestore:', presentation.currentSlideIndex);\n      } catch (err) {\n        console.error('[PresentationEditorV3] Error updating currentSlideIndex:', err);\n      }\n    };\n    updateCurrentSlideIndex();\n  }, [presentation.currentSlideIndex, presentationId, courseId, currentUser]);\n\n  // Find selected element from current slide\n  const selectedElement = React.useMemo(() => {\n    const slide = presentation.slides[presentation.currentSlideIndex];\n    if (!slide) return null;\n    return slide.elements.find(el => el.id === editorState.selectedElement) || null;\n  }, [presentation, editorState.selectedElement]);\n\n  // Compute formatting state for toolbar\n  const formattingState = React.useMemo(() => {\n    if (!selectedElement || selectedElement.type !== 'text') return {};\n    const style = selectedElement.style || {};\n    return {\n      bold: style.fontWeight === 'bold',\n      italic: style.fontStyle === 'italic',\n      underline: style.textDecoration === 'underline',\n      fontSize: style.fontSize || 16,\n      color: style.color || '#000000',\n      align: style.textAlign || 'left',\n    };\n  }, [selectedElement]);\n\n  // Handler for formatting actions\n  const handleFormat = useCallback((action, value) => {\n    if (!selectedElement || selectedElement.type !== 'text') return;\n    setPresentation(prev => {\n      const newSlides = [...prev.slides];\n      const slide = newSlides[prev.currentSlideIndex];\n      const idx = slide.elements.findIndex(el => el.id === selectedElement.id);\n      if (idx === -1) return prev;\n      const el = slide.elements[idx];\n      const style = { ...el.style };\n      switch (action) {\n        case 'bold':\n          style.fontWeight = style.fontWeight === 'bold' ? 'normal' : 'bold';\n          break;\n        case 'italic':\n          style.fontStyle = style.fontStyle === 'italic' ? 'normal' : 'italic';\n          break;\n        case 'underline':\n          style.textDecoration = style.textDecoration === 'underline' ? 'none' : 'underline';\n          break;\n        case 'fontSize':\n          style.fontSize = value || 20; // Default to 20 if not provided\n          break;\n        case 'color':\n          style.color = value || '#000000';\n          break;\n        case 'align':\n          style.textAlign = value;\n          break;\n        default:\n          break;\n      }\n      slide.elements[idx] = { ...el, style };\n      return { ...prev, slides: newSlides };\n    });\n  }, [selectedElement]);\n\n  // Loading state\n  if (isLoading) {\n    return (\n      <div className=\"h-screen flex items-center justify-center bg-gray-100\">\n        <div className=\"text-center\">\n          <div className=\"w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4\"></div>\n          <p className=\"text-gray-600\">Loading presentation...</p>\n        </div>\n      </div>\n    );\n  }\n\n  // Comment submit\n  const handleCommentSubmit = async (e) => {\n    e.preventDefault();\n    if (!commentInput.trim() || !currentUser) return;\n    const currentSlide = slides[presentation.currentSlideIndex];\n    if (!currentSlide) return;\n    const commentsCol = collection(db, 'courses', courseId, 'presentations', presentationId, 'slides', currentSlide.id, 'comments');\n    await addDoc(commentsCol, {\n      text: commentInput,\n      username: currentUser.displayName || currentUser.email || currentUser.uid,\n      likedBy: {},\n      timePosted: serverTimestamp(),\n      groupId: null\n    });\n    setCommentInput(\"\");\n  };\n  // Like handler (likedBy map logic)\n  const handleLike = async (comment) => {\n    if (!currentUser) return;\n    const currentSlide = slides[presentation.currentSlideIndex];\n    if (!currentSlide) return;\n    const likeUserId = currentUser.uid;\n    if (comment.likedBy && comment.likedBy[likeUserId]) return;\n    const newLikedBy = { ...(comment.likedBy || {}) };\n    newLikedBy[likeUserId] = true;\n    const commentRef = doc(db, 'courses', courseId, 'presentations', presentationId, 'slides', currentSlide.id, 'comments', comment.id);\n    // Fetch the current Firestore document to get the exact fields\n    const snap = await getDoc(commentRef);\n    const firestoreData = snap.data();\n    // Build update payload: copy all fields from Firestore, update likedBy\n    const updatePayload = { ...firestoreData, likedBy: newLikedBy };\n    // Remove id field if present\n    delete updatePayload.id;\n    console.log('Firestore comment doc:', firestoreData);\n    console.log('Update payload:', updatePayload);\n    await updateDoc(commentRef, updatePayload);\n  };\n\n  const PresentationFullScreen = React.memo(function PresentationFullScreen({ slides, currentIndex, onClose, onPrev, onNext, showDiscussion, setShowDiscussion, comments, commentInput, setCommentInput, handleCommentSubmit, handleLike, currentUser }) {\n    const total = slides.length;\n    const slide = slides[currentIndex] || {};\n    const containerRef = useRef();\n    // Only use useRef and useEffect for keydown events here. No useState/useEffect for discussion logic.\n    useEffect(() => {\n      const handleKeyDown = (e) => {\n        if (e.key === 'ArrowLeft') onPrev();\n        if (e.key === 'ArrowRight') onNext();\n        if (e.key === 'Escape') onClose();\n      };\n      window.addEventListener('keydown', handleKeyDown);\n      return () => window.removeEventListener('keydown', handleKeyDown);\n    }, [onPrev, onNext, onClose]);\n\n    return (\n      <div ref={containerRef} className=\"fixed inset-0 z-50 bg-black flex flex-col items-center justify-center\" style={{ minHeight: '100vh', minWidth: '100vw' }}>\n        {/* Username at top-right */}\n        <div className=\"absolute top-4 right-8 z-20 text-white text-sm bg-black/60 px-3 py-1 rounded-full shadow\">\n          {currentUser && (currentUser.displayName || currentUser.email || currentUser.uid)}\n        </div>\n        {/* Discussion Icon */}\n        <button\n          className=\"absolute top-4 right-24 z-30 bg-white bg-opacity-80 rounded-full p-2 shadow hover:bg-primary-100\"\n          title=\"Open discussion\"\n          onClick={() => setShowDiscussion(true)}\n        >\n          <MessageSquare className=\"w-6 h-6 text-primary-600\" />\n        </button>\n        {/* Close button */}\n        <button onClick={onClose} className=\"absolute top-4 right-40 text-white text-3xl font-bold bg-black bg-opacity-40 rounded px-3 py-1 hover:bg-opacity-70\"></button>\n        {/* Previous arrow */}\n        <button onClick={onPrev} className=\"absolute left-4 top-1/2 -translate-y-1/2 text-white text-5xl font-bold bg-black bg-opacity-40 rounded-full px-3 py-1 hover:bg-opacity-70\" style={{zIndex: 10}} aria-label=\"Previous slide\">&#8592;</button>\n        {/* Next arrow */}\n        <button onClick={onNext} className=\"absolute right-4 top-1/2 -translate-y-1/2 text-white text-5xl font-bold bg-black bg-opacity-40 rounded-full px-3 py-1 hover:bg-opacity-70\" style={{zIndex: 10}} aria-label=\"Next slide\">&#8594;</button>\n        {/* Slide content */}\n        <div className=\"flex flex-col items-center justify-center w-full h-full\">\n          <div className=\"flex items-center justify-center\" style={{ width: '96vw', height: '96vh', maxWidth: '100vw', maxHeight: '100vh', padding: 0, margin: 0 }}>\n            {slide.imageUrl ? (\n              <img src={slide.imageUrl} alt={slide.title || 'Slide'} style={{ width: '100%', height: '100%', objectFit: 'contain', background: '#222' }} />\n            ) : (\n              <div className=\"bg-white w-full h-full flex flex-col items-center justify-center\">\n                <h2 className=\"text-4xl font-bold mb-4\">{slide.title || 'Untitled Slide'}</h2>\n                <div className=\"text-lg text-gray-700\">{slide.content || ''}</div>\n              </div>\n            )}\n          </div>\n          {/* Slide number overlay */}\n          <div className=\"absolute bottom-8 left-1/2 -translate-x-1/2 bg-black bg-opacity-60 text-white px-4 py-2 rounded text-lg font-semibold\">\n            Slide {currentIndex + 1} / {total}\n          </div>\n        </div>\n        {/* Discussion Overlay */}\n        {showDiscussion && (\n          <div className=\"fixed inset-0 z-60 flex items-center justify-center bg-black bg-opacity-60\">\n            <div className=\"absolute inset-0\" onClick={() => setShowDiscussion(false)} />\n            <div className=\"relative flex w-full h-full z-70\">\n              {/* Left: Grouping area (placeholder) */}\n              <div className=\"flex-1 bg-gray-100 flex flex-col items-center justify-center border-r border-gray-300\">\n                <div className=\"text-gray-400 text-lg\">(Grouping area placeholder)</div>\n              </div>\n              {/* Right: Chat/comments */}\n              <div className=\"w-[400px] max-w-full bg-white flex flex-col h-full shadow-xl\">\n                {/* Header */}\n                <div className=\"flex items-center justify-between px-4 py-3 border-b\">\n                  <div className=\"font-semibold text-lg\">Slide Discussion</div>\n                  <button onClick={() => setShowDiscussion(false)} className=\"text-gray-500 hover:text-primary-600 text-xl\">&times;</button>\n                </div>\n                {/* Chat panel */}\n                <div className=\"flex-1 overflow-y-auto p-4 space-y-3\">\n                  {comments.length === 0 ? (\n                    <div className=\"text-gray-400 text-center\">No messages yet.</div>\n                  ) : (\n                    comments.map((c) => {\n                      const likeUserId = currentUser ? currentUser.uid : '';\n                      const alreadyLiked = c.likedBy && likeUserId && c.likedBy[likeUserId];\n                      const likeCount = c.likedBy ? Object.keys(c.likedBy).length : 0;\n                      return (\n                        <div\n                          key={c.id}\n                          className=\"bg-gray-100 rounded px-3 py-2 flex items-center group\"\n                          title={c.username}\n                        >\n                          {/* Like icon and count */}\n                          <button\n                            className={`flex items-center mr-3 text-gray-500 hover:text-primary-600 focus:outline-none ${alreadyLiked ? 'opacity-50 cursor-not-allowed' : ''}`}\n                            onClick={() => handleLike(c)}\n                            tabIndex={0}\n                            aria-label=\"Like comment\"\n                            disabled={alreadyLiked}\n                          >\n                            <ThumbsUp className=\"w-5 h-5 mr-1\" />\n                            <span className=\"text-sm font-semibold\">{likeCount}</span>\n                          </button>\n                          {/* Comment text */}\n                          <span className=\"text-gray-800 text-sm\" style={{ cursor: 'pointer' }}>\n                            {c.text}\n                          </span>\n                        </div>\n                      );\n                    })\n                  )}\n                </div>\n                {/* Input box */}\n                <form className=\"flex items-center border-t px-4 py-3\" onSubmit={handleCommentSubmit}>\n                  <input\n                    type=\"text\"\n                    className=\"flex-1 border rounded px-3 py-2 mr-2 focus:outline-none focus:border-primary-500\"\n                    placeholder=\"Type a comment...\"\n                    value={commentInput}\n                    onChange={e => setCommentInput(e.target.value)}\n                  />\n                  <button type=\"submit\" className=\"bg-primary-600 text-white px-4 py-2 rounded font-semibold disabled:opacity-50\" disabled={!commentInput.trim()}>\n                    Send\n                  </button>\n                </form>\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n    );\n  });\n\n  // Audience mode change handler\n  const handleAudienceModeChange = async (newMode) => {\n    try {\n      await PresentationService.setAudienceMode(courseId, presentationId, newMode);\n      setAudienceMode(newMode);\n      addToast(`Audience mode set to ${newMode === 'anonymous' ? 'Anonymous' : 'Enrolled Users'}`, 'success');\n    } catch (err) {\n      addToast('Failed to update audience mode', 'error');\n      console.error('[PresentationEditorV3] Error updating audience mode:', err);\n    }\n  };\n\n  return (\n    <div className=\"h-screen flex flex-col\">\n      {/* Toolbar */}\n      <PresentationToolbar\n        editorState={editorState}\n        onToolChange={handleToolChange}\n        onSave={handleSave}\n        onPresent={handlePresent}\n        onUndo={() => {}} // TODO: Implement undo/redo\n        onRedo={() => {}}\n        presentationTitle={presentation.title}\n        onTitleChange={handleTitleChange}\n        isSaving={isSaving}\n        selectedElement={selectedElement}\n        formattingState={formattingState}\n        onFormat={handleFormat}\n        audienceMode={audienceMode}\n        onAudienceModeChange={handleAudienceModeChange}\n      />\n      <div className=\"flex-1 flex\">\n        {/* Sidebar */}\n        <div className=\"h-full overflow-y-auto\" style={{ maxHeight: 'calc(100vh - 64px)', minWidth: 120 }}>\n          <SlidesSidebar\n            slides={presentation.slides}\n            currentSlideIndex={presentation.currentSlideIndex}\n            onSlideSelect={handleSlideSelect}\n            onAddSlide={handleAddSlide}\n            onDuplicateSlide={handleDuplicateSlide}\n            onDeleteSlide={handleDeleteSlide}\n            onAddSlideAfter={handleAddSlideAfter}\n          />\n        </div>\n        {/* Canvas */}\n        <SlideCanvas\n          slide={presentation.slides[presentation.currentSlideIndex]}\n          editorState={editorState}\n          onElementSelect={handleElementSelect}\n          onElementUpdate={handleElementUpdate}\n          onElementAdd={handleElementAdd}\n          onElementDelete={handleElementDelete}\n          onSlideChange={handleSlideChange}\n          isLive={editorState.isPresenting}\n        />\n      </div>\n      {/* Toast notifications */}\n      <ToastContainer toasts={toasts} removeToast={removeToast} />\n      {editorState.isPresenting && (\n        <PresentationFullScreen\n          slides={slides}\n          currentIndex={presentation.currentSlideIndex}\n          onClose={() => setEditorState(prev => ({ ...prev, isPresenting: false }))}\n          onPrev={() => setPresentation(prev => ({ ...prev, currentSlideIndex: Math.max(0, prev.currentSlideIndex - 1) }))}\n          onNext={() => setPresentation(prev => ({ ...prev, currentSlideIndex: Math.min(slides.length - 1, prev.currentSlideIndex + 1) }))}\n          showDiscussion={showDiscussion}\n          setShowDiscussion={setShowDiscussion}\n          comments={memoizedComments}\n          commentInput={commentInput}\n          setCommentInput={setCommentInput}\n          handleCommentSubmit={memoizedHandleCommentSubmit}\n          handleLike={memoizedHandleLike}\n          currentUser={currentUser}\n        />\n      )}\n    </div>\n  );\n} "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}