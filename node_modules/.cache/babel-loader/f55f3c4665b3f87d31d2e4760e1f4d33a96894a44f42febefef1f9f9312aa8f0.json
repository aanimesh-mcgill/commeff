{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\aanime\\\\commeff3\\\\src\\\\pages\\\\PresentationEditorV3.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useCallback, useMemo, useRef } from 'react';\nimport { doc, getDoc, updateDoc, setDoc, collection, getDocs, query, orderBy, onSnapshot, addDoc, serverTimestamp } from 'firebase/firestore';\nimport { db } from '../firebase/config';\nimport { PresentationToolbar } from './PresentationToolbar';\nimport { SlidesSidebar } from './SlidesSidebar';\nimport { SlideCanvas } from './SlideCanvas';\nimport { ToastContainer } from '../components/Toast';\nimport { useAuth } from '../contexts/AuthContext';\nimport PresentationService from '../services/PresentationService';\nimport { ThumbsUp, MessageSquare } from 'lucide-react';\nimport PresentationFullScreen from './PresentationFullScreen';\n\n// Types (replace with import from types/presentation if available)\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst initialPresentation = {\n  id: 'presentation-1',\n  title: 'Untitled Presentation',\n  slides: [{\n    id: 'slide-1',\n    title: 'Welcome Slide',\n    elements: []\n  }],\n  createdAt: new Date(),\n  updatedAt: new Date(),\n  currentSlideIndex: 0\n};\nexport default function PresentationEditorV3({\n  courseId,\n  presentationId = 'demo-presentation',\n  title\n}) {\n  _s();\n  const {\n    currentUser\n  } = useAuth();\n  // All hooks must be at the top, before any return or conditional\n  const [presentation, setPresentation] = useState(initialPresentation);\n  const [editorState, setEditorState] = useState({\n    selectedElement: null,\n    tool: 'select',\n    isPresenting: false,\n    zoom: 100\n  });\n  const [isLoading, setIsLoading] = useState(true);\n  const [isSaving, setIsSaving] = useState(false);\n  const [toasts, setToasts] = useState([]);\n  const [audienceMode, setAudienceMode] = useState('enrolledUsers');\n  const [showDiscussion, setShowDiscussion] = useState(false);\n  const [commentInput, setCommentInput] = useState(\"\");\n  const [comments, setComments] = useState([]);\n  const saveTimeoutRef = useRef(null);\n  // Add state for debug info\n  const [debugInfo, setDebugInfo] = useState({\n    instructorId: '',\n    userRole: ''\n  });\n\n  // In the render, before passing slides to SlidesSidebar\n  const safeSlides = useMemo(() => {\n    return (presentation.slides || []).map(slide => {\n      let safeContent = slide.content;\n      if (Array.isArray(safeContent)) {\n        // Convert array to comma-separated string for preview\n        safeContent = safeContent.join(', ');\n      }\n      return {\n        ...slide,\n        content: safeContent\n      };\n    });\n  }, [presentation.slides]);\n\n  // Toast management\n  const addToast = useCallback((message, type = 'info', duration = 3000) => {\n    const id = Date.now().toString();\n    setToasts(prev => [...prev, {\n      id,\n      message,\n      type,\n      duration\n    }]);\n  }, []);\n  const removeToast = useCallback(id => {\n    setToasts(prev => prev.filter(toast => toast.id !== id));\n  }, []);\n\n  // Load presentation from Firestore\n  useEffect(() => {\n    const loadPresentation = async () => {\n      try {\n        console.log('Loading presentation:', presentationId);\n        const docRef = doc(db, 'courses', courseId, 'presentations', presentationId);\n        const docSnap = await getDoc(docRef);\n        let slides = [];\n        // Fetch slides from subcollection\n        const slidesCol = collection(db, 'courses', courseId, 'presentations', presentationId, 'slides');\n        const slidesQuery = query(slidesCol, orderBy('order'));\n        const slidesSnap = await getDocs(slidesQuery);\n        slides = slidesSnap.docs.map(doc => {\n          const data = doc.data();\n          return {\n            id: doc.id,\n            ...data,\n            elements: Array.isArray(data.elements) ? data.elements : []\n          };\n        });\n        console.log('[PresentationEditorV3] Fetched slides from subcollection:', slides);\n        if (docSnap.exists()) {\n          var _data$createdAt, _data$updatedAt;\n          const data = docSnap.data();\n          setPresentation({\n            ...data,\n            slides,\n            createdAt: ((_data$createdAt = data.createdAt) === null || _data$createdAt === void 0 ? void 0 : _data$createdAt.toDate()) || new Date(),\n            updatedAt: ((_data$updatedAt = data.updatedAt) === null || _data$updatedAt === void 0 ? void 0 : _data$updatedAt.toDate()) || new Date()\n          });\n        } else if (slides.length > 0) {\n          // Presentation doc missing but slides exist (imported): show error, do NOT create doc\n          addToast('Presentation metadata missing. Please contact support.', 'error', 6000);\n          setIsLoading(false);\n          return;\n        } else {\n          // Do NOT create a new doc here. Only allow creation in explicit create flow.\n          addToast('Presentation not found or you do not have access.', 'error', 6000);\n          setIsLoading(false);\n          return;\n        }\n      } catch (error) {\n        console.error('Error loading presentation:', error);\n        if (error.code === 'permission-denied' || error.message.includes('permission')) {\n          addToast('You do not have permission to access this presentation.', 'error', 6000);\n        } else {\n          addToast('Failed to load presentation', 'error');\n        }\n      } finally {\n        setIsLoading(false);\n      }\n    };\n    if (currentUser) loadPresentation();\n  }, [presentationId, addToast, currentUser, courseId]);\n\n  // Add logging after fetching presentation and slides\n  useEffect(() => {\n    if (presentation) {\n      console.log('[PresentationEditorV3] Loaded presentation:', presentation);\n      if (presentation.slides) {\n        console.log('[PresentationEditorV3] Slides array:', presentation.slides);\n        presentation.slides.forEach((slide, idx) => {\n          console.log(`[PresentationEditorV3] Slide ${idx} imageUrl:`, slide.imageUrl);\n        });\n      } else {\n        console.log('[PresentationEditorV3] No slides found in presentation.');\n      }\n    }\n  }, [presentation]);\n\n  // Auto-save with debouncing\n  const savePresentation = useCallback(async presentationData => {\n    try {\n      if (!currentUser) throw new Error('Not authenticated');\n      console.log('Saving presentation:', presentationData);\n      setIsSaving(true);\n      const docRef = doc(db, 'courses', courseId, 'presentations', presentationId);\n      await updateDoc(docRef, {\n        ...presentationData,\n        updatedAt: new Date(),\n        ownerId: currentUser.uid,\n        courseId: courseId || null\n      });\n      console.log('Presentation saved successfully');\n      addToast('Presentation saved', 'success', 2000);\n    } catch (error) {\n      console.error('Error saving presentation:', error);\n      if (error.code === 'permission-denied' || error.message.includes('permission')) {\n        addToast('You do not have permission to save this presentation.', 'error', 6000);\n      } else {\n        addToast('Failed to save presentation', 'error');\n      }\n    } finally {\n      setIsSaving(false);\n    }\n  }, [presentationId, addToast, currentUser, courseId]);\n\n  // Debounced auto-save\n  useEffect(() => {\n    if (saveTimeoutRef.current) {\n      clearTimeout(saveTimeoutRef.current);\n    }\n    if (!isLoading) {\n      saveTimeoutRef.current = setTimeout(() => {\n        savePresentation(presentation);\n      }, 2000); // 2 second delay\n    }\n    return () => {\n      if (saveTimeoutRef.current) {\n        clearTimeout(saveTimeoutRef.current);\n      }\n    };\n  }, [presentation, savePresentation, isLoading]);\n\n  // Manual save handler\n  const handleSave = useCallback(async () => {\n    if (saveTimeoutRef.current) {\n      clearTimeout(saveTimeoutRef.current);\n    }\n    await savePresentation(presentation);\n  }, [presentation, savePresentation]);\n\n  // Helper to reload slides from subcollection\n  const reloadSlides = useCallback(async () => {\n    const slidesCol = collection(db, 'courses', courseId, 'presentations', presentationId, 'slides');\n    const slidesQuery = query(slidesCol, orderBy('order'));\n    const slidesSnap = await getDocs(slidesQuery);\n    const slides = slidesSnap.docs.map(doc => ({\n      id: doc.id,\n      ...doc.data(),\n      elements: Array.isArray(doc.data().elements) ? doc.data().elements : []\n    }));\n    setPresentation(prev => ({\n      ...prev,\n      slides\n    }));\n  }, [courseId, presentationId]);\n\n  // Add slide\n  const handleAddSlide = useCallback(async () => {\n    await PresentationService.addSlide(courseId, presentationId, {\n      title: `Slide ${presentation.slides.length + 1}`,\n      elements: []\n    });\n    addToast('New slide added', 'success', 2000);\n    await reloadSlides();\n  }, [courseId, presentationId, presentation.slides.length, addToast, reloadSlides]);\n\n  // Duplicate slide\n  const handleDuplicateSlide = useCallback(async index => {\n    const slideToDuplicate = presentation.slides[index];\n    const {\n      id,\n      ...slideData\n    } = slideToDuplicate;\n    await PresentationService.addSlide(courseId, presentationId, {\n      ...slideData,\n      title: `${slideToDuplicate.title} (Copy)`\n    });\n    addToast('Slide duplicated', 'success', 2000);\n    await reloadSlides();\n  }, [presentation.slides, courseId, presentationId, addToast, reloadSlides]);\n\n  // Delete slide\n  const handleDeleteSlide = useCallback(async index => {\n    if (presentation.slides.length <= 1) {\n      addToast('Cannot delete the last slide', 'warning');\n      return;\n    }\n    const slideId = presentation.slides[index].id;\n    await PresentationService.deleteSlide(courseId, presentationId, slideId);\n    addToast('Slide deleted', 'success', 2000);\n    await reloadSlides();\n  }, [presentation.slides, courseId, presentationId, addToast, reloadSlides]);\n\n  // Add slide after\n  const handleAddSlideAfter = useCallback(async index => {\n    await PresentationService.addSlide(courseId, presentationId, {\n      title: `Slide ${presentation.slides.length + 1}`,\n      elements: []\n    });\n    addToast('New slide added', 'success', 2000);\n    await reloadSlides();\n  }, [courseId, presentationId, presentation.slides.length, addToast, reloadSlides]);\n\n  // Element management handlers\n  const handleElementSelect = useCallback(elementId => {\n    setEditorState(prev => ({\n      ...prev,\n      selectedElement: elementId\n    }));\n  }, []);\n  const handleElementUpdate = useCallback((elementId, updates) => {\n    setPresentation(prev => {\n      const newSlides = [...prev.slides];\n      const currentSlide = newSlides[prev.currentSlideIndex];\n      const elementIndex = currentSlide.elements.findIndex(el => el.id === elementId);\n      if (elementIndex !== -1) {\n        newSlides[prev.currentSlideIndex] = {\n          ...currentSlide,\n          elements: currentSlide.elements.map((el, index) => index === elementIndex ? {\n            ...el,\n            ...updates\n          } : el)\n        };\n      }\n      return {\n        ...prev,\n        slides: newSlides\n      };\n    });\n  }, []);\n  const handleElementAdd = useCallback(elementData => {\n    const newElement = {\n      id: `element-${Date.now()}`,\n      ...elementData\n    };\n    setPresentation(prev => {\n      const newSlides = [...prev.slides];\n      const currentSlide = newSlides[prev.currentSlideIndex];\n      newSlides[prev.currentSlideIndex] = {\n        ...currentSlide,\n        elements: [...currentSlide.elements, newElement]\n      };\n      return {\n        ...prev,\n        slides: newSlides\n      };\n    });\n\n    // Auto-select the new element\n    setEditorState(prev => ({\n      ...prev,\n      selectedElement: newElement.id\n    }));\n    addToast('Element added', 'success', 1500);\n  }, [addToast]);\n  const handleElementDelete = useCallback(elementId => {\n    setPresentation(prev => {\n      const newSlides = [...prev.slides];\n      const currentSlide = newSlides[prev.currentSlideIndex];\n      newSlides[prev.currentSlideIndex] = {\n        ...currentSlide,\n        elements: currentSlide.elements.filter(el => el.id !== elementId)\n      };\n      return {\n        ...prev,\n        slides: newSlides\n      };\n    });\n    setEditorState(prev => ({\n      ...prev,\n      selectedElement: null\n    }));\n    addToast('Element deleted', 'success', 1500);\n  }, [addToast]);\n\n  // Other handlers\n  const handleToolChange = useCallback(tool => {\n    setEditorState(prev => ({\n      ...prev,\n      tool\n    }));\n  }, []);\n  const handleTitleChange = useCallback(title => {\n    setPresentation(prev => ({\n      ...prev,\n      title\n    }));\n  }, []);\n\n  // Ensure every slide navigation triggers Firestore update\n  const handleSlideSelect = useCallback(index => {\n    setPresentation(prev => ({\n      ...prev,\n      currentSlideIndex: index\n    }));\n    setEditorState(prev => ({\n      ...prev,\n      selectedElement: null\n    }));\n    // Log for debug\n    console.log('[SYNC] handleSlideSelect called, new index:', index);\n  }, []);\n  const handlePresent = useCallback(async () => {\n    setEditorState(prev => ({\n      ...prev,\n      isPresenting: true\n    }));\n    addToast('Starting presentation...', 'info');\n    try {\n      await PresentationService.setLivePresentation(courseId, presentationId);\n      addToast('Presentation is now live!', 'success');\n    } catch (err) {\n      addToast('Failed to set presentation live: ' + (err.message || err), 'error');\n      console.error('[PresentationEditorV3] Error setting presentation live:', err);\n    }\n  }, [addToast, courseId, presentationId]);\n\n  // Remove auto-save useEffect\n  // Add slide change handler\n  const handleSlideChange = useCallback((field, value) => {\n    setPresentation(prev => {\n      const newSlides = [...prev.slides];\n      const idx = prev.currentSlideIndex;\n      if (!newSlides[idx]) return prev;\n      newSlides[idx] = {\n        ...newSlides[idx],\n        [field]: value\n      };\n      return {\n        ...prev,\n        slides: newSlides\n      };\n    });\n  }, []);\n\n  // Update currentSlideIndex in Firestore when it changes\n  useEffect(() => {\n    if (!presentationId || !courseId || !currentUser) return;\n    const updateCurrentSlideIndex = async () => {\n      try {\n        // DEBUG: Log user and instructor info\n        const courseDocRef = doc(db, 'courses', courseId);\n        const courseSnap = await getDoc(courseDocRef);\n        const instructorId = courseSnap.exists() ? courseSnap.data().instructorId : null;\n        console.log('[updateCurrentSlideIndex][DEBUG] currentUser.uid:', currentUser.uid, 'instructorId:', instructorId, 'courseId:', courseId, 'presentationId:', presentationId);\n        const docRef = doc(db, 'courses', courseId, 'presentations', presentationId);\n        await updateDoc(docRef, {\n          currentSlideIndex: presentation.currentSlideIndex\n        });\n      } catch (err) {\n        if (err.code === 'permission-denied' || err.message && err.message.includes('permission')) {\n          console.error('[Firestore][PermissionError] Failed to update currentSlideIndex:', {\n            user: currentUser.uid,\n            courseId,\n            presentationId,\n            error: err\n          });\n        }\n      }\n    };\n    updateCurrentSlideIndex();\n  }, [presentation.currentSlideIndex, presentationId, courseId, currentUser]);\n\n  // Real-time Firestore sync for comments (current slide)\n  useEffect(() => {\n    if (!editorState.isPresenting || !presentationId || !courseId || !Array.isArray(presentation.slides) || !presentation.slides.length) return;\n    const currentSlide = presentation.slides[presentation.currentSlideIndex];\n    if (!currentSlide) return;\n    const commentsCol = collection(db, 'courses', courseId, 'presentations', presentationId, 'slides', currentSlide.id, 'comments');\n    const q = query(commentsCol, orderBy('timePosted', 'asc'));\n    const unsub = onSnapshot(q, snap => {\n      const arr = [];\n      snap.forEach(doc => arr.push({\n        id: doc.id,\n        ...doc.data()\n      }));\n      setComments(arr);\n    }, error => {\n      if (error.code === 'permission-denied' || error.message && error.message.includes('permission')) {\n        console.error('[Firestore][PermissionError] Snapshot listener failed:', {\n          user: currentUser && currentUser.uid,\n          courseId,\n          presentationId,\n          error\n        });\n      }\n    });\n    return () => unsub();\n  }, [editorState.isPresenting, presentationId, courseId, presentation.slides, presentation.currentSlideIndex]);\n\n  // Find selected element from current slide\n  const selectedElement = React.useMemo(() => {\n    const slide = presentation.slides[presentation.currentSlideIndex];\n    if (!slide) return null;\n    return slide.elements.find(el => el.id === editorState.selectedElement) || null;\n  }, [presentation, editorState.selectedElement]);\n\n  // Compute formatting state for toolbar\n  const formattingState = React.useMemo(() => {\n    if (!selectedElement || selectedElement.type !== 'text') return {};\n    const style = selectedElement.style || {};\n    return {\n      bold: style.fontWeight === 'bold',\n      italic: style.fontStyle === 'italic',\n      underline: style.textDecoration === 'underline',\n      fontSize: style.fontSize || 16,\n      color: style.color || '#000000',\n      align: style.textAlign || 'left'\n    };\n  }, [selectedElement]);\n\n  // Handler for formatting actions\n  const handleFormat = useCallback((action, value) => {\n    if (!selectedElement || selectedElement.type !== 'text') return;\n    setPresentation(prev => {\n      const newSlides = [...prev.slides];\n      const slide = newSlides[prev.currentSlideIndex];\n      const idx = slide.elements.findIndex(el => el.id === selectedElement.id);\n      if (idx === -1) return prev;\n      const el = slide.elements[idx];\n      const style = {\n        ...el.style\n      };\n      switch (action) {\n        case 'bold':\n          style.fontWeight = style.fontWeight === 'bold' ? 'normal' : 'bold';\n          break;\n        case 'italic':\n          style.fontStyle = style.fontStyle === 'italic' ? 'normal' : 'italic';\n          break;\n        case 'underline':\n          style.textDecoration = style.textDecoration === 'underline' ? 'none' : 'underline';\n          break;\n        case 'fontSize':\n          style.fontSize = value || 20; // Default to 20 if not provided\n          break;\n        case 'color':\n          style.color = value || '#000000';\n          break;\n        case 'align':\n          style.textAlign = value;\n          break;\n        default:\n          break;\n      }\n      slide.elements[idx] = {\n        ...el,\n        style\n      };\n      return {\n        ...prev,\n        slides: newSlides\n      };\n    });\n  }, [selectedElement]);\n\n  // DEBUG: Log all relevant Firebase info on mount and when loading presentation\n  useEffect(() => {\n    (async () => {\n      try {\n        console.log('[DEBUG] currentUser:', currentUser);\n        if (currentUser) {\n          console.log('[DEBUG] currentUser.uid:', currentUser.uid);\n        }\n        console.log('[DEBUG] courseId:', courseId);\n        console.log('[DEBUG] presentationId:', presentationId);\n        // Fetch and log user doc\n        if (currentUser) {\n          const userDocRef = doc(db, 'users', currentUser.uid);\n          const userSnap = await getDoc(userDocRef);\n          if (userSnap.exists()) {\n            console.log('[DEBUG] user doc:', userSnap.data());\n          } else {\n            console.log('[DEBUG] user doc does not exist');\n          }\n        }\n        // Fetch and log course doc\n        if (courseId) {\n          const courseDocRef = doc(db, 'courses', courseId);\n          const courseSnap = await getDoc(courseDocRef);\n          if (courseSnap.exists()) {\n            console.log('[DEBUG] course doc:', courseSnap.data());\n          } else {\n            console.log('[DEBUG] course doc does not exist');\n          }\n        }\n        // Fetch and log presentation doc\n        if (courseId && presentationId) {\n          const presDocRef = doc(db, 'courses', courseId, 'presentations', presentationId);\n          const presSnap = await getDoc(presDocRef);\n          if (presSnap.exists()) {\n            console.log('[DEBUG] presentation doc:', presSnap.data());\n          } else {\n            console.log('[DEBUG] presentation doc does not exist');\n          }\n        }\n      } catch (err) {\n        console.error('[DEBUG] Error fetching debug info:', err);\n      }\n    })();\n  }, [currentUser, courseId, presentationId]);\n\n  // Fetch instructorId and userRole for debug panel\n  useEffect(() => {\n    async function fetchDebugInfo() {\n      try {\n        let instructorId = '';\n        let userRole = '';\n        if (courseId) {\n          const courseDoc = await getDoc(doc(db, 'courses', courseId));\n          instructorId = courseDoc.exists() ? courseDoc.data().instructorId : '';\n        }\n        if (currentUser) {\n          const userDoc = await getDoc(doc(db, 'users', currentUser.uid));\n          userRole = userDoc.exists() ? userDoc.data().role : '';\n        }\n        setDebugInfo({\n          instructorId,\n          userRole\n        });\n      } catch (e) {\n        setDebugInfo({\n          instructorId: 'ERR',\n          userRole: 'ERR'\n        });\n      }\n    }\n    fetchDebugInfo();\n  }, [courseId, currentUser]);\n\n  // Loading state\n  if (isLoading) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"h-screen flex items-center justify-center bg-gray-100\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-center\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 527,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-gray-600\",\n          children: \"Loading presentation...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 528,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 526,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 525,\n      columnNumber: 7\n    }, this);\n  }\n\n  // Comment submit\n  const handleCommentSubmit = async e => {\n    e.preventDefault();\n    if (!commentInput.trim() || !currentUser) return;\n    const currentSlide = presentation.slides[presentation.currentSlideIndex];\n    if (!currentSlide) return;\n    const commentsCol = collection(db, 'courses', courseId, 'presentations', presentationId, 'slides', currentSlide.id, 'comments');\n    await addDoc(commentsCol, {\n      text: commentInput,\n      username: currentUser.displayName || currentUser.email || currentUser.uid,\n      likedBy: {},\n      timePosted: serverTimestamp(),\n      groupId: null\n    });\n    setCommentInput(\"\");\n  };\n  // Like handler (likedBy map logic)\n  const handleLike = async comment => {\n    let likeUserId;\n    if (currentUser) {\n      likeUserId = currentUser.uid;\n    } else {\n      // Anonymous: use stable anonId from localStorage\n      likeUserId = localStorage.getItem('anonId');\n      if (!likeUserId) {\n        likeUserId = 'anon_' + Math.random().toString(36).substr(2, 9);\n        localStorage.setItem('anonId', likeUserId);\n      }\n    }\n    if (!likeUserId) return;\n    const currentSlide = presentation.slides[presentation.currentSlideIndex];\n    if (!currentSlide) return;\n    if (comment.likedBy && comment.likedBy[likeUserId]) return;\n    const newLikedBy = {\n      ...(comment.likedBy || {})\n    };\n    newLikedBy[likeUserId] = true;\n    const commentRef = doc(db, 'courses', courseId, 'presentations', presentationId, 'slides', currentSlide.id, 'comments', comment.id);\n    const payload = {\n      likedBy: newLikedBy\n    };\n    console.log('[handleLike] Updating comment with payload:', payload);\n    await updateDoc(commentRef, payload);\n  };\n\n  // Audience mode change handler\n  const handleAudienceModeChange = async newMode => {\n    try {\n      await PresentationService.setAudienceMode(courseId, presentationId, newMode);\n      setAudienceMode(newMode);\n      addToast(`Audience mode set to ${newMode === 'anonymous' ? 'Anonymous' : 'Enrolled Users'}`, 'success');\n    } catch (err) {\n      addToast('Failed to update audience mode', 'error');\n      console.error('[PresentationEditorV3] Error updating audience mode:', err);\n    }\n  };\n\n  // Debug log for overlay rendering\n  console.log('[OverlayRender] showDiscussion:', showDiscussion, 'isPresenting:', editorState.isPresenting);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"h-screen flex flex-col\",\n    children: [/*#__PURE__*/_jsxDEV(PresentationToolbar, {\n      editorState: editorState,\n      onToolChange: handleToolChange,\n      onSave: handleSave,\n      onPresent: handlePresent,\n      onUndo: () => {} // TODO: Implement undo/redo\n      ,\n      onRedo: () => {},\n      presentationTitle: presentation.title,\n      onTitleChange: handleTitleChange,\n      isSaving: isSaving,\n      selectedElement: selectedElement,\n      formattingState: formattingState,\n      onFormat: handleFormat,\n      audienceMode: audienceMode,\n      onAudienceModeChange: handleAudienceModeChange\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 592,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        background: '#eee',\n        padding: 8,\n        marginBottom: 8,\n        fontSize: 13,\n        borderRadius: 4\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n        children: \"DEBUG:\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 610,\n        columnNumber: 9\n      }, this), \" user.uid: \", /*#__PURE__*/_jsxDEV(\"code\", {\n        children: currentUser && currentUser.uid\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 610,\n        columnNumber: 43\n      }, this), \" | user.role: \", /*#__PURE__*/_jsxDEV(\"code\", {\n        children: debugInfo.userRole\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 610,\n        columnNumber: 102\n      }, this), \" | courseId: \", /*#__PURE__*/_jsxDEV(\"code\", {\n        children: courseId\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 610,\n        columnNumber: 148\n      }, this), \" | course.instructorId: \", /*#__PURE__*/_jsxDEV(\"code\", {\n        children: debugInfo.instructorId\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 610,\n        columnNumber: 195\n      }, this), \" | presentation.ownerId: \", /*#__PURE__*/_jsxDEV(\"code\", {\n        children: presentation.ownerId\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 610,\n        columnNumber: 257\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 609,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex-1 flex\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"h-full overflow-y-auto\",\n        style: {\n          maxHeight: 'calc(100vh - 64px)',\n          minWidth: 120\n        },\n        children: /*#__PURE__*/_jsxDEV(SlidesSidebar, {\n          slides: safeSlides,\n          currentSlideIndex: presentation.currentSlideIndex || 0,\n          onSlideSelect: handleSlideSelect,\n          onAddSlide: handleAddSlide,\n          onDuplicateSlide: handleDuplicateSlide,\n          onDeleteSlide: handleDeleteSlide,\n          onAddSlideAfter: handleAddSlideAfter\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 615,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 614,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(SlideCanvas, {\n        slide: presentation.slides[presentation.currentSlideIndex],\n        editorState: editorState,\n        onElementSelect: handleElementSelect,\n        onElementUpdate: handleElementUpdate,\n        onElementAdd: handleElementAdd,\n        onElementDelete: handleElementDelete,\n        onSlideChange: handleSlideChange,\n        isLive: editorState.isPresenting\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 626,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 612,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ToastContainer, {\n      toasts: toasts,\n      removeToast: removeToast\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 638,\n      columnNumber: 7\n    }, this), editorState.isPresenting && /*#__PURE__*/_jsxDEV(PresentationFullScreen, {\n      slides: presentation.slides,\n      currentIndex: presentation.currentSlideIndex,\n      onClose: () => setEditorState(prev => ({\n        ...prev,\n        isPresenting: false\n      })),\n      onPrev: async () => {\n        setPresentation(prev => {\n          const newIndex = Math.max(0, prev.currentSlideIndex - 1);\n          console.log('[PRESENTER][NAV] Prev Slide Clicked. New currentSlideIndex:', newIndex);\n          if (presentationId && courseId && currentUser) {\n            const docRef = doc(db, 'courses', courseId, 'presentations', presentationId);\n            console.log('[PRESENTER][NAV] Updating Firestore currentSlideIndex:', newIndex, 'DocRef:', docRef.path);\n            updateDoc(docRef, {\n              currentSlideIndex: newIndex\n            }).then(() => console.log('[PRESENTER][NAV] Firestore update success.')).catch(err => console.error('[PRESENTER][NAV] Firestore update error:', err));\n          }\n          return {\n            ...prev,\n            currentSlideIndex: newIndex\n          };\n        });\n      },\n      onNext: async () => {\n        setPresentation(prev => {\n          const newIndex = Math.min(presentation.slides.length - 1, prev.currentSlideIndex + 1);\n          console.log('[PRESENTER][NAV] Next Slide Clicked. New currentSlideIndex:', newIndex);\n          if (presentationId && courseId && currentUser) {\n            const docRef = doc(db, 'courses', courseId, 'presentations', presentationId);\n            console.log('[PRESENTER][NAV] Updating Firestore currentSlideIndex:', newIndex, 'DocRef:', docRef.path);\n            updateDoc(docRef, {\n              currentSlideIndex: newIndex\n            }).then(() => console.log('[PRESENTER][NAV] Firestore update success.')).catch(err => console.error('[PRESENTER][NAV] Firestore update error:', err));\n          }\n          return {\n            ...prev,\n            currentSlideIndex: newIndex\n          };\n        });\n      },\n      showDiscussion: showDiscussion,\n      setShowDiscussion: setShowDiscussion,\n      comments: comments,\n      commentInput: commentInput,\n      setCommentInput: setCommentInput,\n      handleCommentSubmit: handleCommentSubmit,\n      handleLike: handleLike,\n      currentUser: currentUser\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 640,\n      columnNumber: 9\n    }, this), showDiscussion && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"fixed inset-0 z-[9999] flex items-center justify-center bg-black bg-opacity-60\",\n      style: {\n        pointerEvents: 'auto'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"absolute inset-0\",\n        onClick: e => {\n          e.stopPropagation();\n          setShowDiscussion(false);\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 685,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"relative flex w-full h-full z-70\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex-1 bg-gray-100 flex flex-col items-center justify-center border-r border-gray-300\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-gray-400 text-lg\",\n            children: \"(Grouping area placeholder)\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 689,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 688,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"w-[400px] max-w-full bg-white flex flex-col h-full shadow-xl relative\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-center justify-between px-4 py-3 border-b\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"font-semibold text-lg\",\n              children: \"Slide Discussion\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 695,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"ml-2 text-gray-500 hover:text-red-600 text-2xl font-bold focus:outline-none\",\n              onClick: e => {\n                e.stopPropagation();\n                setShowDiscussion(false);\n              },\n              title: \"Close discussion\",\n              \"aria-label\": \"Close discussion\",\n              children: \"\\xD7\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 697,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 694,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex-1 overflow-y-auto p-4 space-y-3\",\n            children: comments.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"text-gray-400 text-center\",\n              children: \"No messages yet.\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 707,\n              columnNumber: 19\n            }, this) : comments.map(c => {\n              const likeUserId = currentUser ? currentUser.uid : '';\n              const alreadyLiked = c.likedBy && likeUserId && c.likedBy[likeUserId];\n              const likeCount = c.likedBy ? Object.keys(c.likedBy).length : 0;\n              return /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"bg-gray-100 rounded px-3 py-2 flex items-center group\",\n                title: c.username,\n                children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                  className: `flex items-center mr-3 text-gray-500 hover:text-primary-600 focus:outline-none ${alreadyLiked ? 'opacity-50 cursor-not-allowed' : ''}`,\n                  onClick: () => handleLike(c),\n                  tabIndex: 0,\n                  \"aria-label\": \"Like comment\",\n                  disabled: alreadyLiked,\n                  children: [/*#__PURE__*/_jsxDEV(ThumbsUp, {\n                    className: \"w-5 h-5 mr-1\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 727,\n                    columnNumber: 27\n                  }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                    className: \"text-sm font-semibold\",\n                    children: likeCount\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 728,\n                    columnNumber: 27\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 720,\n                  columnNumber: 25\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"text-gray-800 text-sm\",\n                  style: {\n                    cursor: 'pointer'\n                  },\n                  children: c.text\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 731,\n                  columnNumber: 25\n                }, this)]\n              }, c.id, true, {\n                fileName: _jsxFileName,\n                lineNumber: 714,\n                columnNumber: 23\n              }, this);\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 705,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n            className: \"flex items-center border-t px-4 py-3\",\n            onSubmit: handleCommentSubmit,\n            children: [/*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"text\",\n              className: \"flex-1 border rounded px-3 py-2 mr-2 focus:outline-none focus:border-primary-500\",\n              placeholder: \"Type a comment...\",\n              value: commentInput,\n              onChange: e => setCommentInput(e.target.value)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 741,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              type: \"submit\",\n              className: \"bg-primary-600 text-white px-4 py-2 rounded font-semibold disabled:opacity-50\",\n              disabled: !commentInput.trim(),\n              children: \"Send\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 748,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 740,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 692,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 686,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 684,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 590,\n    columnNumber: 5\n  }, this);\n}\n_s(PresentationEditorV3, \"5hsLOeImlefLWQ2F//z5esHSIN8=\", false, function () {\n  return [useAuth];\n});\n_c = PresentationEditorV3;\nvar _c;\n$RefreshReg$(_c, \"PresentationEditorV3\");","map":{"version":3,"names":["React","useState","useEffect","useCallback","useMemo","useRef","doc","getDoc","updateDoc","setDoc","collection","getDocs","query","orderBy","onSnapshot","addDoc","serverTimestamp","db","PresentationToolbar","SlidesSidebar","SlideCanvas","ToastContainer","useAuth","PresentationService","ThumbsUp","MessageSquare","PresentationFullScreen","jsxDEV","_jsxDEV","initialPresentation","id","title","slides","elements","createdAt","Date","updatedAt","currentSlideIndex","PresentationEditorV3","courseId","presentationId","_s","currentUser","presentation","setPresentation","editorState","setEditorState","selectedElement","tool","isPresenting","zoom","isLoading","setIsLoading","isSaving","setIsSaving","toasts","setToasts","audienceMode","setAudienceMode","showDiscussion","setShowDiscussion","commentInput","setCommentInput","comments","setComments","saveTimeoutRef","debugInfo","setDebugInfo","instructorId","userRole","safeSlides","map","slide","safeContent","content","Array","isArray","join","addToast","message","type","duration","now","toString","prev","removeToast","filter","toast","loadPresentation","console","log","docRef","docSnap","slidesCol","slidesQuery","slidesSnap","docs","data","exists","_data$createdAt","_data$updatedAt","toDate","length","error","code","includes","forEach","idx","imageUrl","savePresentation","presentationData","Error","ownerId","uid","current","clearTimeout","setTimeout","handleSave","reloadSlides","handleAddSlide","addSlide","handleDuplicateSlide","index","slideToDuplicate","slideData","handleDeleteSlide","slideId","deleteSlide","handleAddSlideAfter","handleElementSelect","elementId","handleElementUpdate","updates","newSlides","currentSlide","elementIndex","findIndex","el","handleElementAdd","elementData","newElement","handleElementDelete","handleToolChange","handleTitleChange","handleSlideSelect","handlePresent","setLivePresentation","err","handleSlideChange","field","value","updateCurrentSlideIndex","courseDocRef","courseSnap","user","commentsCol","q","unsub","snap","arr","push","find","formattingState","style","bold","fontWeight","italic","fontStyle","underline","textDecoration","fontSize","color","align","textAlign","handleFormat","action","userDocRef","userSnap","presDocRef","presSnap","fetchDebugInfo","courseDoc","userDoc","role","e","className","children","fileName","_jsxFileName","lineNumber","columnNumber","handleCommentSubmit","preventDefault","trim","text","username","displayName","email","likedBy","timePosted","groupId","handleLike","comment","likeUserId","localStorage","getItem","Math","random","substr","setItem","newLikedBy","commentRef","payload","handleAudienceModeChange","newMode","onToolChange","onSave","onPresent","onUndo","onRedo","presentationTitle","onTitleChange","onFormat","onAudienceModeChange","background","padding","marginBottom","borderRadius","maxHeight","minWidth","onSlideSelect","onAddSlide","onDuplicateSlide","onDeleteSlide","onAddSlideAfter","onElementSelect","onElementUpdate","onElementAdd","onElementDelete","onSlideChange","isLive","currentIndex","onClose","onPrev","newIndex","max","path","then","catch","onNext","min","pointerEvents","onClick","stopPropagation","c","alreadyLiked","likeCount","Object","keys","tabIndex","disabled","cursor","onSubmit","placeholder","onChange","target","_c","$RefreshReg$"],"sources":["C:/Users/aanime/commeff3/src/pages/PresentationEditorV3.jsx"],"sourcesContent":["import React, { useState, useEffect, useCallback, useMemo, useRef } from 'react';\nimport { doc, getDoc, updateDoc, setDoc, collection, getDocs, query, orderBy, onSnapshot, addDoc, serverTimestamp } from 'firebase/firestore';\nimport { db } from '../firebase/config';\nimport { PresentationToolbar } from './PresentationToolbar';\nimport { SlidesSidebar } from './SlidesSidebar';\nimport { SlideCanvas } from './SlideCanvas';\nimport { ToastContainer } from '../components/Toast';\nimport { useAuth } from '../contexts/AuthContext';\nimport PresentationService from '../services/PresentationService';\nimport { ThumbsUp, MessageSquare } from 'lucide-react';\nimport PresentationFullScreen from './PresentationFullScreen';\n\n// Types (replace with import from types/presentation if available)\nconst initialPresentation = {\n  id: 'presentation-1',\n  title: 'Untitled Presentation',\n  slides: [\n    {\n      id: 'slide-1',\n      title: 'Welcome Slide',\n      elements: [],\n    },\n  ],\n  createdAt: new Date(),\n  updatedAt: new Date(),\n  currentSlideIndex: 0,\n};\n\nexport default function PresentationEditorV3({ courseId, presentationId = 'demo-presentation', title }) {\n  const { currentUser } = useAuth();\n  // All hooks must be at the top, before any return or conditional\n  const [presentation, setPresentation] = useState(initialPresentation);\n  const [editorState, setEditorState] = useState({\n    selectedElement: null,\n    tool: 'select',\n    isPresenting: false,\n    zoom: 100,\n  });\n  const [isLoading, setIsLoading] = useState(true);\n  const [isSaving, setIsSaving] = useState(false);\n  const [toasts, setToasts] = useState([]);\n  const [audienceMode, setAudienceMode] = useState('enrolledUsers');\n  const [showDiscussion, setShowDiscussion] = useState(false);\n  const [commentInput, setCommentInput] = useState(\"\");\n  const [comments, setComments] = useState([]);\n  const saveTimeoutRef = useRef(null);\n  // Add state for debug info\n  const [debugInfo, setDebugInfo] = useState({ instructorId: '', userRole: '' });\n\n  // In the render, before passing slides to SlidesSidebar\n  const safeSlides = useMemo(() => {\n    return (presentation.slides || []).map(slide => {\n      let safeContent = slide.content;\n      if (Array.isArray(safeContent)) {\n        // Convert array to comma-separated string for preview\n        safeContent = safeContent.join(', ');\n      }\n      return { ...slide, content: safeContent };\n    });\n  }, [presentation.slides]);\n\n  // Toast management\n  const addToast = useCallback((message, type = 'info', duration = 3000) => {\n    const id = Date.now().toString();\n    setToasts(prev => [...prev, { id, message, type, duration }]);\n  }, []);\n\n  const removeToast = useCallback((id) => {\n    setToasts(prev => prev.filter(toast => toast.id !== id));\n  }, []);\n\n  // Load presentation from Firestore\n  useEffect(() => {\n    const loadPresentation = async () => {\n      try {\n        console.log('Loading presentation:', presentationId);\n        const docRef = doc(db, 'courses', courseId, 'presentations', presentationId);\n        const docSnap = await getDoc(docRef);\n        let slides = [];\n        // Fetch slides from subcollection\n        const slidesCol = collection(db, 'courses', courseId, 'presentations', presentationId, 'slides');\n        const slidesQuery = query(slidesCol, orderBy('order'));\n        const slidesSnap = await getDocs(slidesQuery);\n        slides = slidesSnap.docs.map(doc => {\n          const data = doc.data();\n          return {\n            id: doc.id,\n            ...data,\n            elements: Array.isArray(data.elements) ? data.elements : [],\n          };\n        });\n        console.log('[PresentationEditorV3] Fetched slides from subcollection:', slides);\n        if (docSnap.exists()) {\n          const data = docSnap.data();\n          setPresentation({\n            ...data,\n            slides,\n            createdAt: data.createdAt?.toDate() || new Date(),\n            updatedAt: data.updatedAt?.toDate() || new Date(),\n          });\n        } else if (slides.length > 0) {\n          // Presentation doc missing but slides exist (imported): show error, do NOT create doc\n          addToast('Presentation metadata missing. Please contact support.', 'error', 6000);\n          setIsLoading(false);\n          return;\n        } else {\n          // Do NOT create a new doc here. Only allow creation in explicit create flow.\n          addToast('Presentation not found or you do not have access.', 'error', 6000);\n          setIsLoading(false);\n          return;\n        }\n      } catch (error) {\n        console.error('Error loading presentation:', error);\n        if (error.code === 'permission-denied' || error.message.includes('permission')) {\n          addToast('You do not have permission to access this presentation.', 'error', 6000);\n        } else {\n          addToast('Failed to load presentation', 'error');\n        }\n      } finally {\n        setIsLoading(false);\n      }\n    };\n    if (currentUser) loadPresentation();\n  }, [presentationId, addToast, currentUser, courseId]);\n\n  // Add logging after fetching presentation and slides\n  useEffect(() => {\n    if (presentation) {\n      console.log('[PresentationEditorV3] Loaded presentation:', presentation);\n      if (presentation.slides) {\n        console.log('[PresentationEditorV3] Slides array:', presentation.slides);\n        presentation.slides.forEach((slide, idx) => {\n          console.log(`[PresentationEditorV3] Slide ${idx} imageUrl:`, slide.imageUrl);\n        });\n      } else {\n        console.log('[PresentationEditorV3] No slides found in presentation.');\n      }\n    }\n  }, [presentation]);\n\n  // Auto-save with debouncing\n  const savePresentation = useCallback(async (presentationData) => {\n    try {\n      if (!currentUser) throw new Error('Not authenticated');\n      console.log('Saving presentation:', presentationData);\n      setIsSaving(true);\n      \n      const docRef = doc(db, 'courses', courseId, 'presentations', presentationId);\n      await updateDoc(docRef, {\n        ...presentationData,\n        updatedAt: new Date(),\n        ownerId: currentUser.uid,\n        courseId: courseId || null,\n      });\n      \n      console.log('Presentation saved successfully');\n      addToast('Presentation saved', 'success', 2000);\n    } catch (error) {\n      console.error('Error saving presentation:', error);\n      if (error.code === 'permission-denied' || error.message.includes('permission')) {\n        addToast('You do not have permission to save this presentation.', 'error', 6000);\n      } else {\n        addToast('Failed to save presentation', 'error');\n      }\n    } finally {\n      setIsSaving(false);\n    }\n  }, [presentationId, addToast, currentUser, courseId]);\n\n  // Debounced auto-save\n  useEffect(() => {\n    if (saveTimeoutRef.current) {\n      clearTimeout(saveTimeoutRef.current);\n    }\n    \n    if (!isLoading) {\n      saveTimeoutRef.current = setTimeout(() => {\n        savePresentation(presentation);\n      }, 2000); // 2 second delay\n    }\n\n    return () => {\n      if (saveTimeoutRef.current) {\n        clearTimeout(saveTimeoutRef.current);\n      }\n    };\n  }, [presentation, savePresentation, isLoading]);\n\n  // Manual save handler\n  const handleSave = useCallback(async () => {\n    if (saveTimeoutRef.current) {\n      clearTimeout(saveTimeoutRef.current);\n    }\n    await savePresentation(presentation);\n  }, [presentation, savePresentation]);\n\n  // Helper to reload slides from subcollection\n  const reloadSlides = useCallback(async () => {\n    const slidesCol = collection(db, 'courses', courseId, 'presentations', presentationId, 'slides');\n    const slidesQuery = query(slidesCol, orderBy('order'));\n    const slidesSnap = await getDocs(slidesQuery);\n    const slides = slidesSnap.docs.map(doc => ({ id: doc.id, ...doc.data(), elements: Array.isArray(doc.data().elements) ? doc.data().elements : [] }));\n    setPresentation(prev => ({ ...prev, slides }));\n  }, [courseId, presentationId]);\n\n  // Add slide\n  const handleAddSlide = useCallback(async () => {\n    await PresentationService.addSlide(courseId, presentationId, { title: `Slide ${presentation.slides.length + 1}`, elements: [] });\n    addToast('New slide added', 'success', 2000);\n    await reloadSlides();\n  }, [courseId, presentationId, presentation.slides.length, addToast, reloadSlides]);\n\n  // Duplicate slide\n  const handleDuplicateSlide = useCallback(async (index) => {\n    const slideToDuplicate = presentation.slides[index];\n    const { id, ...slideData } = slideToDuplicate;\n    await PresentationService.addSlide(courseId, presentationId, { ...slideData, title: `${slideToDuplicate.title} (Copy)` });\n    addToast('Slide duplicated', 'success', 2000);\n    await reloadSlides();\n  }, [presentation.slides, courseId, presentationId, addToast, reloadSlides]);\n\n  // Delete slide\n  const handleDeleteSlide = useCallback(async (index) => {\n    if (presentation.slides.length <= 1) {\n      addToast('Cannot delete the last slide', 'warning');\n      return;\n    }\n    const slideId = presentation.slides[index].id;\n    await PresentationService.deleteSlide(courseId, presentationId, slideId);\n    addToast('Slide deleted', 'success', 2000);\n    await reloadSlides();\n  }, [presentation.slides, courseId, presentationId, addToast, reloadSlides]);\n\n  // Add slide after\n  const handleAddSlideAfter = useCallback(async (index) => {\n    await PresentationService.addSlide(courseId, presentationId, { title: `Slide ${presentation.slides.length + 1}`, elements: [] });\n    addToast('New slide added', 'success', 2000);\n    await reloadSlides();\n  }, [courseId, presentationId, presentation.slides.length, addToast, reloadSlides]);\n\n  // Element management handlers\n  const handleElementSelect = useCallback((elementId) => {\n    setEditorState(prev => ({ ...prev, selectedElement: elementId }));\n  }, []);\n\n  const handleElementUpdate = useCallback((elementId, updates) => {\n    setPresentation(prev => {\n      const newSlides = [...prev.slides];\n      const currentSlide = newSlides[prev.currentSlideIndex];\n      const elementIndex = currentSlide.elements.findIndex(el => el.id === elementId);\n      \n      if (elementIndex !== -1) {\n        newSlides[prev.currentSlideIndex] = {\n          ...currentSlide,\n          elements: currentSlide.elements.map((el, index) =>\n            index === elementIndex ? { ...el, ...updates } : el\n          ),\n        };\n      }\n      \n      return { ...prev, slides: newSlides };\n    });\n  }, []);\n\n  const handleElementAdd = useCallback((elementData) => {\n    const newElement = {\n      id: `element-${Date.now()}`,\n      ...elementData,\n    };\n    \n    setPresentation(prev => {\n      const newSlides = [...prev.slides];\n      const currentSlide = newSlides[prev.currentSlideIndex];\n      \n      newSlides[prev.currentSlideIndex] = {\n        ...currentSlide,\n        elements: [...currentSlide.elements, newElement],\n      };\n      \n      return { ...prev, slides: newSlides };\n    });\n    \n    // Auto-select the new element\n    setEditorState(prev => ({ ...prev, selectedElement: newElement.id }));\n    addToast('Element added', 'success', 1500);\n  }, [addToast]);\n\n  const handleElementDelete = useCallback((elementId) => {\n    setPresentation(prev => {\n      const newSlides = [...prev.slides];\n      const currentSlide = newSlides[prev.currentSlideIndex];\n      \n      newSlides[prev.currentSlideIndex] = {\n        ...currentSlide,\n        elements: currentSlide.elements.filter(el => el.id !== elementId),\n      };\n      \n      return { ...prev, slides: newSlides };\n    });\n    \n    setEditorState(prev => ({ ...prev, selectedElement: null }));\n    addToast('Element deleted', 'success', 1500);\n  }, [addToast]);\n\n  // Other handlers\n  const handleToolChange = useCallback((tool) => {\n    setEditorState(prev => ({ ...prev, tool }));\n  }, []);\n\n  const handleTitleChange = useCallback((title) => {\n    setPresentation(prev => ({ ...prev, title }));\n  }, []);\n\n  // Ensure every slide navigation triggers Firestore update\n  const handleSlideSelect = useCallback((index) => {\n    setPresentation(prev => ({ ...prev, currentSlideIndex: index }));\n    setEditorState(prev => ({ ...prev, selectedElement: null }));\n    // Log for debug\n    console.log('[SYNC] handleSlideSelect called, new index:', index);\n  }, []);\n\n  const handlePresent = useCallback(async () => {\n    setEditorState(prev => ({ ...prev, isPresenting: true }));\n    addToast('Starting presentation...', 'info');\n    try {\n      await PresentationService.setLivePresentation(courseId, presentationId);\n      addToast('Presentation is now live!', 'success');\n    } catch (err) {\n      addToast('Failed to set presentation live: ' + (err.message || err), 'error');\n      console.error('[PresentationEditorV3] Error setting presentation live:', err);\n    }\n  }, [addToast, courseId, presentationId]);\n\n  // Remove auto-save useEffect\n  // Add slide change handler\n  const handleSlideChange = useCallback((field, value) => {\n    setPresentation(prev => {\n      const newSlides = [...prev.slides];\n      const idx = prev.currentSlideIndex;\n      if (!newSlides[idx]) return prev;\n      newSlides[idx] = { ...newSlides[idx], [field]: value };\n      return { ...prev, slides: newSlides };\n    });\n  }, []);\n\n  // Update currentSlideIndex in Firestore when it changes\n  useEffect(() => {\n    if (!presentationId || !courseId || !currentUser) return;\n    const updateCurrentSlideIndex = async () => {\n      try {\n        // DEBUG: Log user and instructor info\n        const courseDocRef = doc(db, 'courses', courseId);\n        const courseSnap = await getDoc(courseDocRef);\n        const instructorId = courseSnap.exists() ? courseSnap.data().instructorId : null;\n        console.log('[updateCurrentSlideIndex][DEBUG] currentUser.uid:', currentUser.uid, 'instructorId:', instructorId, 'courseId:', courseId, 'presentationId:', presentationId);\n        const docRef = doc(db, 'courses', courseId, 'presentations', presentationId);\n        await updateDoc(docRef, { currentSlideIndex: presentation.currentSlideIndex });\n      } catch (err) {\n        if (err.code === 'permission-denied' || (err.message && err.message.includes('permission'))) {\n          console.error('[Firestore][PermissionError] Failed to update currentSlideIndex:', {\n            user: currentUser.uid,\n            courseId,\n            presentationId,\n            error: err\n          });\n        }\n      }\n    };\n    updateCurrentSlideIndex();\n  }, [presentation.currentSlideIndex, presentationId, courseId, currentUser]);\n\n  // Real-time Firestore sync for comments (current slide)\n  useEffect(() => {\n    if (!editorState.isPresenting || !presentationId || !courseId || !Array.isArray(presentation.slides) || !presentation.slides.length) return;\n    const currentSlide = presentation.slides[presentation.currentSlideIndex];\n    if (!currentSlide) return;\n    const commentsCol = collection(db, 'courses', courseId, 'presentations', presentationId, 'slides', currentSlide.id, 'comments');\n    const q = query(commentsCol, orderBy('timePosted', 'asc'));\n    const unsub = onSnapshot(q, (snap) => {\n      const arr = [];\n      snap.forEach(doc => arr.push({ id: doc.id, ...doc.data() }));\n      setComments(arr);\n    }, (error) => {\n      if (error.code === 'permission-denied' || (error.message && error.message.includes('permission'))) {\n        console.error('[Firestore][PermissionError] Snapshot listener failed:', {\n          user: currentUser && currentUser.uid,\n          courseId,\n          presentationId,\n          error\n        });\n      }\n    });\n    return () => unsub();\n  }, [editorState.isPresenting, presentationId, courseId, presentation.slides, presentation.currentSlideIndex]);\n\n  // Find selected element from current slide\n  const selectedElement = React.useMemo(() => {\n    const slide = presentation.slides[presentation.currentSlideIndex];\n    if (!slide) return null;\n    return slide.elements.find(el => el.id === editorState.selectedElement) || null;\n  }, [presentation, editorState.selectedElement]);\n\n  // Compute formatting state for toolbar\n  const formattingState = React.useMemo(() => {\n    if (!selectedElement || selectedElement.type !== 'text') return {};\n    const style = selectedElement.style || {};\n    return {\n      bold: style.fontWeight === 'bold',\n      italic: style.fontStyle === 'italic',\n      underline: style.textDecoration === 'underline',\n      fontSize: style.fontSize || 16,\n      color: style.color || '#000000',\n      align: style.textAlign || 'left',\n    };\n  }, [selectedElement]);\n\n  // Handler for formatting actions\n  const handleFormat = useCallback((action, value) => {\n    if (!selectedElement || selectedElement.type !== 'text') return;\n    setPresentation(prev => {\n      const newSlides = [...prev.slides];\n      const slide = newSlides[prev.currentSlideIndex];\n      const idx = slide.elements.findIndex(el => el.id === selectedElement.id);\n      if (idx === -1) return prev;\n      const el = slide.elements[idx];\n      const style = { ...el.style };\n      switch (action) {\n        case 'bold':\n          style.fontWeight = style.fontWeight === 'bold' ? 'normal' : 'bold';\n          break;\n        case 'italic':\n          style.fontStyle = style.fontStyle === 'italic' ? 'normal' : 'italic';\n          break;\n        case 'underline':\n          style.textDecoration = style.textDecoration === 'underline' ? 'none' : 'underline';\n          break;\n        case 'fontSize':\n          style.fontSize = value || 20; // Default to 20 if not provided\n          break;\n        case 'color':\n          style.color = value || '#000000';\n          break;\n        case 'align':\n          style.textAlign = value;\n          break;\n        default:\n          break;\n      }\n      slide.elements[idx] = { ...el, style };\n      return { ...prev, slides: newSlides };\n    });\n  }, [selectedElement]);\n\n  // DEBUG: Log all relevant Firebase info on mount and when loading presentation\n  useEffect(() => {\n    (async () => {\n      try {\n        console.log('[DEBUG] currentUser:', currentUser);\n        if (currentUser) {\n          console.log('[DEBUG] currentUser.uid:', currentUser.uid);\n        }\n        console.log('[DEBUG] courseId:', courseId);\n        console.log('[DEBUG] presentationId:', presentationId);\n        // Fetch and log user doc\n        if (currentUser) {\n          const userDocRef = doc(db, 'users', currentUser.uid);\n          const userSnap = await getDoc(userDocRef);\n          if (userSnap.exists()) {\n            console.log('[DEBUG] user doc:', userSnap.data());\n          } else {\n            console.log('[DEBUG] user doc does not exist');\n          }\n        }\n        // Fetch and log course doc\n        if (courseId) {\n          const courseDocRef = doc(db, 'courses', courseId);\n          const courseSnap = await getDoc(courseDocRef);\n          if (courseSnap.exists()) {\n            console.log('[DEBUG] course doc:', courseSnap.data());\n          } else {\n            console.log('[DEBUG] course doc does not exist');\n          }\n        }\n        // Fetch and log presentation doc\n        if (courseId && presentationId) {\n          const presDocRef = doc(db, 'courses', courseId, 'presentations', presentationId);\n          const presSnap = await getDoc(presDocRef);\n          if (presSnap.exists()) {\n            console.log('[DEBUG] presentation doc:', presSnap.data());\n          } else {\n            console.log('[DEBUG] presentation doc does not exist');\n          }\n        }\n      } catch (err) {\n        console.error('[DEBUG] Error fetching debug info:', err);\n      }\n    })();\n  }, [currentUser, courseId, presentationId]);\n\n  // Fetch instructorId and userRole for debug panel\n  useEffect(() => {\n    async function fetchDebugInfo() {\n      try {\n        let instructorId = '';\n        let userRole = '';\n        if (courseId) {\n          const courseDoc = await getDoc(doc(db, 'courses', courseId));\n          instructorId = courseDoc.exists() ? courseDoc.data().instructorId : '';\n        }\n        if (currentUser) {\n          const userDoc = await getDoc(doc(db, 'users', currentUser.uid));\n          userRole = userDoc.exists() ? userDoc.data().role : '';\n        }\n        setDebugInfo({ instructorId, userRole });\n      } catch (e) {\n        setDebugInfo({ instructorId: 'ERR', userRole: 'ERR' });\n      }\n    }\n    fetchDebugInfo();\n  }, [courseId, currentUser]);\n\n  // Loading state\n  if (isLoading) {\n    return (\n      <div className=\"h-screen flex items-center justify-center bg-gray-100\">\n        <div className=\"text-center\">\n          <div className=\"w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4\"></div>\n          <p className=\"text-gray-600\">Loading presentation...</p>\n        </div>\n      </div>\n    );\n  }\n\n  // Comment submit\n  const handleCommentSubmit = async (e) => {\n    e.preventDefault();\n    if (!commentInput.trim() || !currentUser) return;\n    const currentSlide = presentation.slides[presentation.currentSlideIndex];\n    if (!currentSlide) return;\n    const commentsCol = collection(db, 'courses', courseId, 'presentations', presentationId, 'slides', currentSlide.id, 'comments');\n    await addDoc(commentsCol, {\n      text: commentInput,\n      username: currentUser.displayName || currentUser.email || currentUser.uid,\n      likedBy: {},\n      timePosted: serverTimestamp(),\n      groupId: null\n    });\n    setCommentInput(\"\");\n  };\n  // Like handler (likedBy map logic)\n  const handleLike = async (comment) => {\n    let likeUserId;\n    if (currentUser) {\n      likeUserId = currentUser.uid;\n    } else {\n      // Anonymous: use stable anonId from localStorage\n      likeUserId = localStorage.getItem('anonId');\n      if (!likeUserId) {\n        likeUserId = 'anon_' + Math.random().toString(36).substr(2, 9);\n        localStorage.setItem('anonId', likeUserId);\n      }\n    }\n    if (!likeUserId) return;\n    const currentSlide = presentation.slides[presentation.currentSlideIndex];\n    if (!currentSlide) return;\n    if (comment.likedBy && comment.likedBy[likeUserId]) return;\n    const newLikedBy = { ...(comment.likedBy || {}) };\n    newLikedBy[likeUserId] = true;\n    const commentRef = doc(db, 'courses', courseId, 'presentations', presentationId, 'slides', currentSlide.id, 'comments', comment.id);\n    const payload = { likedBy: newLikedBy };\n    console.log('[handleLike] Updating comment with payload:', payload);\n    await updateDoc(commentRef, payload);\n  };\n\n  // Audience mode change handler\n  const handleAudienceModeChange = async (newMode) => {\n    try {\n      await PresentationService.setAudienceMode(courseId, presentationId, newMode);\n      setAudienceMode(newMode);\n      addToast(`Audience mode set to ${newMode === 'anonymous' ? 'Anonymous' : 'Enrolled Users'}`, 'success');\n    } catch (err) {\n      addToast('Failed to update audience mode', 'error');\n      console.error('[PresentationEditorV3] Error updating audience mode:', err);\n    }\n  };\n\n  // Debug log for overlay rendering\n  console.log('[OverlayRender] showDiscussion:', showDiscussion, 'isPresenting:', editorState.isPresenting);\n  return (\n    <div className=\"h-screen flex flex-col\">\n      {/* Toolbar */}\n      <PresentationToolbar\n        editorState={editorState}\n        onToolChange={handleToolChange}\n        onSave={handleSave}\n        onPresent={handlePresent}\n        onUndo={() => {}} // TODO: Implement undo/redo\n        onRedo={() => {}}\n        presentationTitle={presentation.title}\n        onTitleChange={handleTitleChange}\n        isSaving={isSaving}\n        selectedElement={selectedElement}\n        formattingState={formattingState}\n        onFormat={handleFormat}\n        audienceMode={audienceMode}\n        onAudienceModeChange={handleAudienceModeChange}\n      />\n      {/* Debug Panel */}\n      <div style={{ background: '#eee', padding: 8, marginBottom: 8, fontSize: 13, borderRadius: 4 }}>\n        <strong>DEBUG:</strong> user.uid: <code>{currentUser && currentUser.uid}</code> | user.role: <code>{debugInfo.userRole}</code> | courseId: <code>{courseId}</code> | course.instructorId: <code>{debugInfo.instructorId}</code> | presentation.ownerId: <code>{presentation.ownerId}</code>\n      </div>\n      <div className=\"flex-1 flex\">\n        {/* Sidebar */}\n        <div className=\"h-full overflow-y-auto\" style={{ maxHeight: 'calc(100vh - 64px)', minWidth: 120 }}>\n          <SlidesSidebar\n            slides={safeSlides}\n            currentSlideIndex={presentation.currentSlideIndex || 0}\n            onSlideSelect={handleSlideSelect}\n            onAddSlide={handleAddSlide}\n            onDuplicateSlide={handleDuplicateSlide}\n            onDeleteSlide={handleDeleteSlide}\n            onAddSlideAfter={handleAddSlideAfter}\n          />\n        </div>\n        {/* Canvas */}\n        <SlideCanvas\n          slide={presentation.slides[presentation.currentSlideIndex]}\n          editorState={editorState}\n          onElementSelect={handleElementSelect}\n          onElementUpdate={handleElementUpdate}\n          onElementAdd={handleElementAdd}\n          onElementDelete={handleElementDelete}\n          onSlideChange={handleSlideChange}\n          isLive={editorState.isPresenting}\n        />\n      </div>\n      {/* Toast notifications */}\n      <ToastContainer toasts={toasts} removeToast={removeToast} />\n      {editorState.isPresenting && (\n        <PresentationFullScreen\n          slides={presentation.slides}\n          currentIndex={presentation.currentSlideIndex}\n          onClose={() => setEditorState(prev => ({ ...prev, isPresenting: false }))}\n          onPrev={async () => {\n            setPresentation(prev => {\n              const newIndex = Math.max(0, prev.currentSlideIndex - 1);\n              console.log('[PRESENTER][NAV] Prev Slide Clicked. New currentSlideIndex:', newIndex);\n              if (presentationId && courseId && currentUser) {\n                const docRef = doc(db, 'courses', courseId, 'presentations', presentationId);\n                console.log('[PRESENTER][NAV] Updating Firestore currentSlideIndex:', newIndex, 'DocRef:', docRef.path);\n                updateDoc(docRef, { currentSlideIndex: newIndex })\n                  .then(() => console.log('[PRESENTER][NAV] Firestore update success.'))\n                  .catch(err => console.error('[PRESENTER][NAV] Firestore update error:', err));\n              }\n              return { ...prev, currentSlideIndex: newIndex };\n            });\n          }}\n          onNext={async () => {\n            setPresentation(prev => {\n              const newIndex = Math.min(presentation.slides.length - 1, prev.currentSlideIndex + 1);\n              console.log('[PRESENTER][NAV] Next Slide Clicked. New currentSlideIndex:', newIndex);\n              if (presentationId && courseId && currentUser) {\n                const docRef = doc(db, 'courses', courseId, 'presentations', presentationId);\n                console.log('[PRESENTER][NAV] Updating Firestore currentSlideIndex:', newIndex, 'DocRef:', docRef.path);\n                updateDoc(docRef, { currentSlideIndex: newIndex })\n                  .then(() => console.log('[PRESENTER][NAV] Firestore update success.'))\n                  .catch(err => console.error('[PRESENTER][NAV] Firestore update error:', err));\n              }\n              return { ...prev, currentSlideIndex: newIndex };\n            });\n          }}\n          showDiscussion={showDiscussion}\n          setShowDiscussion={setShowDiscussion}\n          comments={comments}\n          commentInput={commentInput}\n          setCommentInput={setCommentInput}\n          handleCommentSubmit={handleCommentSubmit}\n          handleLike={handleLike}\n          currentUser={currentUser}\n        />\n      )}\n      {/* Discussion Overlay rendered at the top level, not inside PresentationFullScreen */}\n      {showDiscussion && (\n        <div className=\"fixed inset-0 z-[9999] flex items-center justify-center bg-black bg-opacity-60\" style={{pointerEvents: 'auto'}}>\n          <div className=\"absolute inset-0\" onClick={e => { e.stopPropagation(); setShowDiscussion(false); }} />\n          <div className=\"relative flex w-full h-full z-70\">\n            {/* Left: Grouping area (placeholder) */}\n            <div className=\"flex-1 bg-gray-100 flex flex-col items-center justify-center border-r border-gray-300\">\n              <div className=\"text-gray-400 text-lg\">(Grouping area placeholder)</div>\n            </div>\n            {/* Right: Chat/comments */}\n            <div className=\"w-[400px] max-w-full bg-white flex flex-col h-full shadow-xl relative\">\n              {/* Header */}\n              <div className=\"flex items-center justify-between px-4 py-3 border-b\">\n                <div className=\"font-semibold text-lg\">Slide Discussion</div>\n                {/* X button to close overlay */}\n                <button\n                  className=\"ml-2 text-gray-500 hover:text-red-600 text-2xl font-bold focus:outline-none\"\n                  onClick={e => { e.stopPropagation(); setShowDiscussion(false); }}\n                  title=\"Close discussion\"\n                  aria-label=\"Close discussion\"\n                >×</button>\n              </div>\n              {/* Chat panel */}\n              <div className=\"flex-1 overflow-y-auto p-4 space-y-3\">\n                {comments.length === 0 ? (\n                  <div className=\"text-gray-400 text-center\">No messages yet.</div>\n                ) : (\n                  comments.map((c) => {\n                    const likeUserId = currentUser ? currentUser.uid : '';\n                    const alreadyLiked = c.likedBy && likeUserId && c.likedBy[likeUserId];\n                    const likeCount = c.likedBy ? Object.keys(c.likedBy).length : 0;\n                    return (\n                      <div\n                        key={c.id}\n                        className=\"bg-gray-100 rounded px-3 py-2 flex items-center group\"\n                        title={c.username}\n                      >\n                        {/* Like icon and count */}\n                        <button\n                          className={`flex items-center mr-3 text-gray-500 hover:text-primary-600 focus:outline-none ${alreadyLiked ? 'opacity-50 cursor-not-allowed' : ''}`}\n                          onClick={() => handleLike(c)}\n                          tabIndex={0}\n                          aria-label=\"Like comment\"\n                          disabled={alreadyLiked}\n                        >\n                          <ThumbsUp className=\"w-5 h-5 mr-1\" />\n                          <span className=\"text-sm font-semibold\">{likeCount}</span>\n                        </button>\n                        {/* Comment text */}\n                        <span className=\"text-gray-800 text-sm\" style={{ cursor: 'pointer' }}>\n                          {c.text}\n                        </span>\n                      </div>\n                    );\n                  })\n                )}\n              </div>\n              {/* Input box */}\n              <form className=\"flex items-center border-t px-4 py-3\" onSubmit={handleCommentSubmit}>\n                <input\n                  type=\"text\"\n                  className=\"flex-1 border rounded px-3 py-2 mr-2 focus:outline-none focus:border-primary-500\"\n                  placeholder=\"Type a comment...\"\n                  value={commentInput}\n                  onChange={e => setCommentInput(e.target.value)}\n                />\n                <button type=\"submit\" className=\"bg-primary-600 text-white px-4 py-2 rounded font-semibold disabled:opacity-50\" disabled={!commentInput.trim()}>\n                  Send\n                </button>\n              </form>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n} "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}