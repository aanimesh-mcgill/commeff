{"ast":null,"code":"var _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport { db, storage } from '../firebase/config';\nimport { collection, doc, addDoc, updateDoc, deleteDoc, onSnapshot, query, orderBy } from 'firebase/firestore';\nimport { ref, uploadBytes, getDownloadURL } from 'firebase/storage';\nimport { v4 as uuidv4 } from 'uuid';\nimport { DragDropContext, Droppable, Draggable } from 'react-beautiful-dnd';\nexport default function PresentationBuilder({\n  courseId,\n  presentationId\n}) {\n  _s();\n  console.log('[PresentationBuilder] courseId:', courseId, 'presentationId:', presentationId);\n  const [slides, setSlides] = useState([]);\n  const [previewMode, setPreviewMode] = useState(false);\n  const [currentSlideIndex, setCurrentSlideIndex] = useState(0);\n  const slidesRef = collection(db, 'courses', courseId, 'presentations', presentationId, 'slides');\n  useEffect(() => {\n    console.log('[PresentationBuilder] useEffect: subscribing to slidesRef', slidesRef);\n    const q = query(slidesRef, orderBy('order'));\n    const unsub = onSnapshot(q, snapshot => {\n      const data = snapshot.docs.map(doc => ({\n        id: doc.id,\n        ...doc.data()\n      }));\n      console.log('[PresentationBuilder] Slides fetched:', data);\n      setSlides(data);\n    }, error => {\n      console.error('[PresentationBuilder] Error fetching slides:', error);\n    });\n    return () => {\n      console.log('[PresentationBuilder] Unsubscribing from slidesRef');\n      unsub();\n    };\n  }, [presentationId]);\n  useEffect(() => {\n    const handleKeyDown = e => {\n      if (!previewMode) return;\n      if (e.key === 'ArrowRight') setCurrentSlideIndex(i => Math.min(i + 1, slides.length - 1));\n      if (e.key === 'ArrowLeft') setCurrentSlideIndex(i => Math.max(i - 1, 0));\n    };\n    window.addEventListener('keydown', handleKeyDown);\n    return () => window.removeEventListener('keydown', handleKeyDown);\n  }, [previewMode, slides.length]);\n  const addSlide = async (type = 'mcq') => {\n    try {\n      await addDoc(slidesRef, {\n        type,\n        header: '',\n        content: [''],\n        correctIndexes: [],\n        imageUrl: '',\n        order: slides.length\n      });\n      console.log('[PresentationBuilder] Slide added. Type:', type);\n    } catch (err) {\n      console.error('[PresentationBuilder] Error adding slide:', err);\n    }\n  };\n  const updateSlide = async (id, data) => {\n    try {\n      await updateDoc(doc(slidesRef, id), data);\n      console.log('[PresentationBuilder] Slide updated:', id, data);\n    } catch (err) {\n      console.error('[PresentationBuilder] Error updating slide:', err);\n    }\n  };\n  const deleteSlide = async id => {\n    try {\n      await deleteDoc(doc(slidesRef, id));\n      console.log('[PresentationBuilder] Slide deleted:', id);\n    } catch (err) {\n      console.error('[PresentationBuilder] Error deleting slide:', err);\n    }\n  };\n  const handleImageUpload = async (file, slideId) => {\n    try {\n      const storageRef = ref(storage, `slides/${slideId}/${file.name}`);\n      await uploadBytes(storageRef, file);\n      const url = await getDownloadURL(storageRef);\n      await updateSlide(slideId, {\n        imageUrl: url\n      });\n      console.log('[PresentationBuilder] Image uploaded for slide:', slideId, url);\n    } catch (err) {\n      console.error('[PresentationBuilder] Error uploading image:', err);\n    }\n  };\n  const onDragEnd = async result => {\n    if (!result.destination) return;\n    const reordered = Array.from(slides);\n    const [removed] = reordered.splice(result.source.index, 1);\n    reordered.splice(result.destination.index, 0, removed);\n    for (let i = 0; i < reordered.length; i++) {\n      try {\n        await updateSlide(reordered[i].id, {\n          order: i\n        });\n      } catch (err) {\n        console.error('[PresentationBuilder] Error updating slide order:', err);\n      }\n    }\n    console.log('[PresentationBuilder] Slides reordered.');\n  };\n  const toggleFullScreen = () => {\n    const elem = document.documentElement;\n    if (!document.fullscreenElement) {\n      elem.requestFullscreen().catch(err => console.error('[PresentationBuilder] Fullscreen error:', err));\n    } else {\n      document.exitFullscreen();\n    }\n  };\n}\n_s(PresentationBuilder, \"E0lgxn8/c0itH0roYt96Ar7nv5w=\");\n_c = PresentationBuilder;\nvar _c;\n$RefreshReg$(_c, \"PresentationBuilder\");","map":{"version":3,"names":["React","useState","useEffect","db","storage","collection","doc","addDoc","updateDoc","deleteDoc","onSnapshot","query","orderBy","ref","uploadBytes","getDownloadURL","v4","uuidv4","DragDropContext","Droppable","Draggable","PresentationBuilder","courseId","presentationId","_s","console","log","slides","setSlides","previewMode","setPreviewMode","currentSlideIndex","setCurrentSlideIndex","slidesRef","q","unsub","snapshot","data","docs","map","id","error","handleKeyDown","e","key","i","Math","min","length","max","window","addEventListener","removeEventListener","addSlide","type","header","content","correctIndexes","imageUrl","order","err","updateSlide","deleteSlide","handleImageUpload","file","slideId","storageRef","name","url","onDragEnd","result","destination","reordered","Array","from","removed","splice","source","index","toggleFullScreen","elem","document","documentElement","fullscreenElement","requestFullscreen","catch","exitFullscreen","_c","$RefreshReg$"],"sources":["C:/Users/aanime/commeff3/src/pages/PresentationBuilder.jsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { db, storage } from '../firebase/config';\r\nimport {\r\n  collection,\r\n  doc,\r\n  addDoc,\r\n  updateDoc,\r\n  deleteDoc,\r\n  onSnapshot,\r\n  query,\r\n  orderBy\r\n} from 'firebase/firestore';\r\nimport { ref, uploadBytes, getDownloadURL } from 'firebase/storage';\r\nimport { v4 as uuidv4 } from 'uuid';\r\nimport { DragDropContext, Droppable, Draggable } from 'react-beautiful-dnd';\r\n\r\nexport default function PresentationBuilder({ courseId, presentationId }) {\r\n  console.log('[PresentationBuilder] courseId:', courseId, 'presentationId:', presentationId);\r\n  const [slides, setSlides] = useState([]);\r\n  const [previewMode, setPreviewMode] = useState(false);\r\n  const [currentSlideIndex, setCurrentSlideIndex] = useState(0);\r\n\r\n  const slidesRef = collection(db, 'courses', courseId, 'presentations', presentationId, 'slides');\r\n\r\n  useEffect(() => {\r\n    console.log('[PresentationBuilder] useEffect: subscribing to slidesRef', slidesRef);\r\n    const q = query(slidesRef, orderBy('order'));\r\n    const unsub = onSnapshot(q, (snapshot) => {\r\n      const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n      console.log('[PresentationBuilder] Slides fetched:', data);\r\n      setSlides(data);\r\n    }, (error) => {\r\n      console.error('[PresentationBuilder] Error fetching slides:', error);\r\n    });\r\n    return () => {\r\n      console.log('[PresentationBuilder] Unsubscribing from slidesRef');\r\n      unsub();\r\n    };\r\n  }, [presentationId]);\r\n\r\n  useEffect(() => {\r\n    const handleKeyDown = (e) => {\r\n      if (!previewMode) return;\r\n      if (e.key === 'ArrowRight') setCurrentSlideIndex((i) => Math.min(i + 1, slides.length - 1));\r\n      if (e.key === 'ArrowLeft') setCurrentSlideIndex((i) => Math.max(i - 1, 0));\r\n    };\r\n    window.addEventListener('keydown', handleKeyDown);\r\n    return () => window.removeEventListener('keydown', handleKeyDown);\r\n  }, [previewMode, slides.length]);\r\n\r\n  const addSlide = async (type = 'mcq') => {\r\n    try {\r\n      await addDoc(slidesRef, {\r\n        type,\r\n        header: '',\r\n        content: [''],\r\n        correctIndexes: [],\r\n        imageUrl: '',\r\n        order: slides.length\r\n      });\r\n      console.log('[PresentationBuilder] Slide added. Type:', type);\r\n    } catch (err) {\r\n      console.error('[PresentationBuilder] Error adding slide:', err);\r\n    }\r\n  };\r\n\r\n  const updateSlide = async (id, data) => {\r\n    try {\r\n      await updateDoc(doc(slidesRef, id), data);\r\n      console.log('[PresentationBuilder] Slide updated:', id, data);\r\n    } catch (err) {\r\n      console.error('[PresentationBuilder] Error updating slide:', err);\r\n    }\r\n  };\r\n\r\n  const deleteSlide = async (id) => {\r\n    try {\r\n      await deleteDoc(doc(slidesRef, id));\r\n      console.log('[PresentationBuilder] Slide deleted:', id);\r\n    } catch (err) {\r\n      console.error('[PresentationBuilder] Error deleting slide:', err);\r\n    }\r\n  };\r\n\r\n  const handleImageUpload = async (file, slideId) => {\r\n    try {\r\n      const storageRef = ref(storage, `slides/${slideId}/${file.name}`);\r\n      await uploadBytes(storageRef, file);\r\n      const url = await getDownloadURL(storageRef);\r\n      await updateSlide(slideId, { imageUrl: url });\r\n      console.log('[PresentationBuilder] Image uploaded for slide:', slideId, url);\r\n    } catch (err) {\r\n      console.error('[PresentationBuilder] Error uploading image:', err);\r\n    }\r\n  };\r\n\r\n  const onDragEnd = async (result) => {\r\n    if (!result.destination) return;\r\n    const reordered = Array.from(slides);\r\n    const [removed] = reordered.splice(result.source.index, 1);\r\n    reordered.splice(result.destination.index, 0, removed);\r\n    for (let i = 0; i < reordered.length; i++) {\r\n      try {\r\n        await updateSlide(reordered[i].id, { order: i });\r\n      } catch (err) {\r\n        console.error('[PresentationBuilder] Error updating slide order:', err);\r\n      }\r\n    }\r\n    console.log('[PresentationBuilder] Slides reordered.');\r\n  };\r\n\r\n  const toggleFullScreen = () => {\r\n    const elem = document.documentElement;\r\n    if (!document.fullscreenElement) {\r\n      elem.requestFullscreen().catch(err => console.error('[PresentationBuilder] Fullscreen error:', err));\r\n    } else {\r\n      document.exitFullscreen();\r\n    }\r\n  };\r\n} "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}